(function(){var t,e,n,i,r,o=function(t,e){return function(){return t.apply(e,arguments)}},s={}.hasOwnProperty,l=function(t,e){function n(){this.constructor=t}for(var i in e)s.call(e,i)&&(t[i]=e[i]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},a=[].slice;Backbone.Giraffe=window.Giraffe=t={version:"0.1.4",app:null,apps:{},views:{}},e=function(){var t,e;return"undefined"!=typeof console&&null!==console?null!=(t=console.error)?t.apply(console,(e=["Backbone.Giraffe error:"]).concat.apply(e,arguments)):void 0:void 0},t.View=function(n){function i(e){this.render=o(this.render,this),t.configure(this,e),this.children=[],this.parent=null,this._renderedOnce=!1,this._isAttached=!1,this._createEventsFromUIElements(),"string"==typeof this.templateStrategy&&t.View.setTemplateStrategy(this.templateStrategy,this),i.__super__.constructor.apply(this,arguments)}return l(i,n),i.defaultOptions={disposeOnDetach:!0},i.prototype.beforeInitialize=function(){return this._cache(),this.$el.attr("data-view-cid",this.cid),this.setParent(t.View.getClosestView(this.$el)),this._cacheUiElements()},i.prototype._attachMethods=["append","prepend","html","after","before","insertAfter","insertBefore"],i.prototype._siblingAttachMethods=["after","before","insertAfter","insertBefore"],i.prototype.attachTo=function(n,i){var r,o,s,l,a,h;return l=(null!=i?i.method:void 0)||"append",s=(null!=i?i.forceRender:void 0)||!1,h=(null!=i?i.suppressRender:void 0)||!1,this.$el?(_.contains(this._attachMethods,l)||(e("The attach method '"+l+"' isn't supported. Defaulting to 'append'.",l,this._attachMethods),l="append"),o=t.View.to$El(n),1!==o.length?(e("Expected to render to a single element but found "+o.length,n),this):(r=_.contains(this._siblingAttachMethods,l)?o.parent():o,"insertAfter"===l&&(l="after"),"insertBefore"===l&&(l="before"),this.detach(!0),this.setParent(t.View.getClosestView(r)),"html"===l&&(t.View.detachByEl(o),o.empty()),o[l](this.$el),this._isAttached=!0,a=!h&&(!this._renderedOnce||s||this.alwaysRender),a&&this.render(i),this.saveScrollPosition&&this._loadScrollPosition(),null!=this.documentTitle&&(document.title=this.documentTitle),this)):(e("Trying to attach a disposed view. Make a new one or create the view with the option `disposeOnDetach` set to false.",this),this)},i.prototype.attach=function(n,i){var r,o;if(o=null,null!=i?i.el:void 0){if(r=t.View.to$El(i.el,this.$el,!0),!r.length)return e("Attempting to attach to an element that doesn't exist inside this view!",i,n,this),this;o=r}else o=this.$el;return n.attachTo(o,i),this},i.prototype.render=function(t){var e;return this.beforeRender.apply(this,arguments),this._renderedOnce=!0,this.detachChildren(null!=t?t.preserve:void 0),e=this.templateStrategy.apply(this,arguments)||"",this.$el.empty()[0].innerHTML=e,this._cacheUiElements(),this.afterRender.apply(this,arguments),this},i.prototype.beforeRender=function(){},i.prototype.afterRender=function(){},i.prototype.templateStrategy=function(){return""},i.prototype.template=null,i.prototype.serialize=function(){return this},i.prototype.detach=function(t){return null==t&&(t=!1),this._isAttached?(this._isAttached=!1,this.saveScrollPosition&&this._saveScrollPosition(),this.$el.detach(),this.disposeOnDetach&&!t&&this.dispose(),this):this},i.prototype.detachChildren=function(t){var e,n,i,r;for(null==t&&(t=!1),r=this.children.slice(),n=0,i=r.length;i>n;n++)e=r[n],"function"==typeof e.detach&&e.detach(t);return this},i.prototype._saveScrollPosition=function(){return this._scrollPosition=this._getScrollPositionEl().scrollTop(),this},i.prototype._loadScrollPosition=function(){return null!=this._scrollPosition&&this._getScrollPositionEl().scrollTop(this._scrollPosition),this},i.prototype._getScrollPositionEl=function(){var e;return"boolean"==typeof this.saveScrollPosition||this.$el.is(this.saveScrollPosition)?this.$el:(e=t.View.to$El(this.saveScrollPosition,this.$el).first(),e.length?e:(e=t.View.to$El(this.saveScrollPosition).first(),e.length?e:this.$el))},i.prototype.addChild=function(t){var e;return _.contains(this.children,t)||(null!=(e=t.parent)&&e.removeChild(t,!0),t.parent=this,this.children.push(t)),this},i.prototype.addChildren=function(t){var e,n,i;for(n=0,i=t.length;i>n;n++)e=t[n],this.addChild(e);return this},i.prototype.removeChild=function(t,e){var n;return null==e&&(e=!1),n=_.indexOf(this.children,t),n>-1&&(this.children.splice(n,1),t.parent=null,e?"function"==typeof t.detach&&t.detach(!0):"function"==typeof t.dispose&&t.dispose()),this},i.prototype.removeChildren=function(t){var e,n,i,r;for(null==t&&(t=!1),r=this.children.slice(),n=0,i=r.length;i>n;n++)e=r[n],this.removeChild(e,t);return this},i.prototype.setParent=function(t){return t&&t!==this?t.addChild(this):this.parent&&(this.parent.removeChild(this,!0),this.parent=null),this},i.prototype.isAttached=function(t){return null!=t?t.$el?this.parent===t:this.$el.parent().is(t):$(document).find(this.$el).length>0},i.prototype.ui=null,i.prototype._cacheUiElements=function(){var t,e,n;if(this.ui){n=this.ui;for(t in n)e=n[t],this[t]=function(){switch(typeof e){case"string":return this.$(e);case"function":return e.call(this);default:return e}}.call(this)}return this},i.prototype._uncacheUiElements=function(){var t;if(this.ui)for(t in this.ui)delete this[t];return this},i.prototype._createEventsFromUIElements=function(){var t,e,n,i;if(!this.events||!this.ui)return this;"function"==typeof this.ui&&(this.ui=this.ui.call(this)),"function"==typeof this.events&&(this.events=this.events.call(this)),i=this.events;for(t in i)e=i[t],n=this._getEventKeyFromUIElements(t),n!==t&&(delete this.events[t],this.events[n]=e);return this},i.prototype._getEventKeyFromUIElements=function(t){var e,n,i,r;return i=t.split(" "),n=i.length,2>n?t:(e=i[n-1],r=this.ui[e],r?(i[n-1]=r,i.join(" ")):t)},i.prototype.dataEvents=null,i.prototype._uncache=function(){return delete t.views[this.cid],this},i.prototype._cache=function(){return t.views[this.cid]=this,this},i.prototype.invoke=function(){var t,n,i;for(n=arguments[0],t=arguments.length>=2?a.call(arguments,1):[],i=this;i&&!i[n];)i=i.parent;return(null!=i?i[n]:void 0)?i[n].apply(i,t):(e("No such method name in view hierarchy",n,t,this),!1)},i.prototype.appEvents=null,i.prototype.beforeDispose=function(){return this.setParent(null),this.removeChildren(),this._uncacheUiElements(),this._uncache(),this._isAttached=!1,this.$el?(this.remove(),this.$el=null):e("Disposed of a view that has already been disposed",this),this},i.detachByEl=function(e,n){var i,r,o,s;for(null==n&&(n=!1),r=t.View.to$El(e);(i=r.find("[data-view-cid]:first")).length;)o=i.attr("data-view-cid"),s=t.View.getByCid(o),s.detach(n);return this},i.getClosestView=function(e){var n,i;return n=t.View.to$El(e),i=n.closest("[data-view-cid]").attr("data-view-cid"),t.View.getByCid(i)},i.getByCid=function(e){return t.views[e]},i.to$El=function(e,n,i){var r;return null==i&&(i=!1),n?(r=t.View.to$El(n),(null!=e?e.$el:void 0)&&(e=e.$el),i&&r.is(e)?r:r.find(e)):(null!=e?e.$el:void 0)?e.$el:e instanceof $?e:$(e)},i.setDocumentEvents=function(e){var n,i,r,o;for("string"==typeof e&&(e=e.split(" ")),_.isArray(e)||(e=[e]),e=_.compact(e),t.View.removeDocumentEvents(),t.View._currentDocumentEvents=e,o=[],i=0,r=e.length;r>i;i++)n=e[i],o.push(function(e){return $(document).on(e,"[data-gf-"+e+"]",function(n){var i,r,o;return i=$(n.target).closest("[data-gf-"+e+"]"),r=i.attr("data-gf-"+e),o=t.View.getClosestView(i),o.invoke(r,n)})}(n));return o},i.removeDocumentEvents=function(){var e,n,i,r,o;if(null!=(r=t.View._currentDocumentEvents)?r.length:void 0){for(o=t.View._currentDocumentEvents,n=0,i=o.length;i>n;n++)e=o[n],$(document).off(e,"[data-gf-"+e+"]");return t.View._currentDocumentEvents=null}},i.setTemplateStrategy=function(n,i){var r,o;if(r=typeof n,"function"===r)o=n;else{if("string"!==r)return e("Unrecognized template strategy",n);switch(n.toLowerCase()){case"underscore-template-selector":o=function(){var t,e=this;if(!this.template)return"";if(!this._templateFn)switch(typeof this.template){case"string":t=this.template,this._templateFn=_.template($(t).html()||"");break;case"function":this._templateFn=function(n){return t=e.template(),_.template($(t).html()||"",n)};break;default:throw Error("this.template must be string or function")}return this._templateFn(this.serialize.apply(this,arguments))};break;case"underscore-template":o=function(){var t=this;if(!this.template)return"";if(!this._templateFn)switch(typeof this.template){case"string":this._templateFn=_.template(this.template);break;case"function":this._templateFn=function(e){return _.template(t.template(),e)};break;default:throw Error("this.template must be string or function")}return this._templateFn(this.serialize.apply(this,arguments))};break;case"jst":o=function(){var t;if(!this.template)return"";if(!this._templateFn)switch(typeof this.template){case"string":t=this.template,this._templateFn=function(){return t};break;case"function":this._templateFn=this.template;break;default:throw Error("this.template must be string or function")}return this._templateFn(this.serialize.apply(this,arguments))};break;default:throw Error("Unrecognized template strategy: "+n)}}return i?i.templateStrategy=o:t.View.prototype.templateStrategy=o},i}(Backbone.View),t.View.setTemplateStrategy("underscore-template-selector"),t.View.setDocumentEvents(["click","change"]),t.App=function(n){function i(){this._onUnload=o(this._onUnload,this),this.app=this,this._initializers=[],this.started=!1,i.__super__.constructor.apply(this,arguments)}return l(i,n),i.prototype._cache=function(){return null==t.app&&(t.app=this),t.apps[this.cid]=this,this.routes&&null==this.router&&(this.router=new t.Router({app:this,triggers:this.routes})),$(window).on("unload",this._onUnload),i.__super__._cache.apply(this,arguments)},i.prototype._uncache=function(){return t.app===this&&(t.app=null),delete t.apps[this.cid],this.router&&(this.router=null),$(window).off("unload",this._onUnload),i.__super__._uncache.apply(this,arguments)},i.prototype._onUnload=function(){return this.dispose()},i.prototype.appEvents=null,i.prototype.routes=null,i.prototype.addInitializer=function(t){return this.started?(t.call(this,this._startOptions),_.extend(this,this._startOptions)):this._initializers.push(t),this},i.prototype.start=function(t){var n,i=this;return null==t&&(t={}),this._startOptions=t,this.trigger("app:initializing",t),n=function(r){var o;return r?e(r):(o=i._initializers.shift(),o?2===o.length?o.call(i,t,n):(o.call(i,t),n()):(_.extend(i,t),i.started=!0,i.trigger("app:initialized",t)))},n(),this},i}(t.View),t.Router=function(n){function i(n){return t.configure(this,n),this.app?(this.app.addChild(this),"function"==typeof this.triggers&&(this.triggers=this.triggers.call(this)),this.triggers?(this._routes={},this._bindTriggers(),i.__super__.constructor.apply(this,arguments),void 0):e("Giraffe routers require a `triggers` map of routes to app events.")):e("Giraffe routers require an app! Please create an instance of Giraffe.App before creating a router.")}return l(i,n),i.prototype.namespace="",i.prototype._fullNamespace=function(){return this.parentRouter?this.parentRouter._fullNamespace()+"/"+this.namespace:this.namespace},i.prototype.triggers=null,i.prototype._bindTriggers=function(){var t,n,i,r,o,s=this;this.triggers||e("Expected router to implement `triggers` hash in the form {route: appEvent}"),n=this._fullNamespace(),n.length>0&&(n+="/"),o=this.triggers,r=function(t,e,n){var i;return 0===_.indexOf(e,"-> ")?i=function(){var t;return t=e.slice(3),s.navigate(t,{trigger:!0})}:0===_.indexOf(e,"=> ")?i=function(){var t;return t=e.slice(3),s.navigate(n+t,{trigger:!0})}:(t=n+t,i=function(){var n,i;return n=arguments.length>=1?a.call(arguments,0):[],(i=s.app).trigger.apply(i,[e].concat(a.call(n),[t]))},s._registerRoute(e,t)),s.route(t,e,i)};for(i in o)t=o[i],r(i,t,n);return this},i.prototype._unbindTriggers=function(){var t;return t=this._getTriggerRegExpStrings(),Backbone.history.handlers=_.reject(Backbone.history.handlers,function(e){return _.contains(t,""+e.route)})},i.prototype._getTriggerRegExpStrings=function(){return _.map(_.keys(this.triggers),function(t){return""+Backbone.Router.prototype._routeToRegExp(t)})},i.prototype.cause=function(){var t,e,n,i;return e=arguments[0],t=arguments.length>=2?a.call(arguments,1):[],n=this.getRoute.apply(this,[e].concat(a.call(t))),null!=n?Backbone.history.navigate(n,{trigger:!0}):(i=this.app).trigger.apply(i,[e].concat(a.call(t)))},i.prototype.isCaused=function(){var t,e,n;return e=arguments[0],t=arguments.length>=2?a.call(arguments,1):[],n=this.getRoute.apply(this,[e].concat(a.call(t))),null!=n?Backbone.history._hasPushState?window.location.pathname.slice(1)===n:window.location.hash===n:!1},i.prototype.getRoute=function(){var t,e,n;return e=arguments[0],t=arguments.length>=2?a.call(arguments,1):[],n=this._routes[e],null!=n?(n=this._reverseHash.apply(this,[n].concat(a.call(t))),n?Backbone.history._hasPushState?n:"#"+n:""===n?"":null):null},i.prototype._registerRoute=function(t,e){return this._routes[t]=e},i.prototype._reverseHash=function(){var t,e,n,i,r;return i=arguments[0],t=arguments.length>=2?a.call(arguments,1):[],e=t[0],null==e?i:(r=/:\w+|\*\w+/g,n=_.isObject(e)?i.replace(r,function(t){var n;return n=t.slice(1),e[n]||""}):i.replace(r,function(){return t.shift()||""}))},i.prototype.reload=function(t){return t&&(Backbone.history.stop(),window.location=t),window.location.reload()},i.prototype.appEvents=null,i.prototype.beforeDispose=function(){return this._unbindTriggers()},i}(Backbone.Router),t.Model=function(e){function n(e,i){t.configure(this,i),n.__super__.constructor.apply(this,arguments)}return l(n,e),n.defaultOptions={omittedOptions:"parse"},n.prototype.appEvents=null,n.prototype.beforeDispose=function(){var t;return null!=(t=this.collection)?t.remove(this):void 0},n}(Backbone.Model),t.Collection=function(e){function n(e,i){t.configure(this,i),n.__super__.constructor.apply(this,arguments)}return l(n,e),n.defaultOptions={omittedOptions:"parse"},n.prototype.model=t.Model,n.prototype.appEvents=null,n.prototype.beforeDispose=function(){var t,e,n,i;for(i=this.models.slice(),e=0,n=i.length;n>e;e++)t=i[e],t.dispose();return this},n}(Backbone.Collection),t.dispose=function(){var t,e;return e=arguments[0],t=arguments.length>=2?a.call(arguments,1):[],"function"==typeof e.trigger&&e.trigger.apply(e,["disposing",e].concat(a.call(t))),"function"==typeof e.beforeDispose&&e.beforeDispose.apply(e,t),e.app=null,"function"==typeof e.stopListening&&e.stopListening(),"function"==typeof e.trigger&&e.trigger.apply(e,["disposed",e].concat(a.call(t))),"function"==typeof e.afterDispose&&e.afterDispose.apply(e,t),e},t.defaultOptions={dispose:function(){return t.dispose(this)}},t.configure=function(i,r){var o,s;return(o=null!=i?i.constructor:void 0)?(s=_.extend({},t.defaultOptions,o.defaultOptions,i.defaultOptions,r),_.extend(i,_.omit(s,s.omittedOptions)),null==i.app&&(i.app=t.app),i.appEvents&&t.bindAppEvents(i),i.initialize?t.wrapFn(i,"initialize",null,n):n.call(i),i):e("Only functions can be configured")},n=function(){return this.dataEvents?t.bindDataEvents(this):void 0},t.wrapFn=function(t,e,n,i){var r,o;return o=t[e],"function"==typeof o?(r=e[0].toUpperCase()+e.slice(1),t[e]=function(){var e,s,l,h;return e=arguments.length>=1?a.call(arguments,0):[],null!=n&&n.apply(t,e),"function"==typeof t[l="before"+r]&&t[l].apply(t,e),s=o.apply(t,e),"function"==typeof t[h="after"+r]&&t[h].apply(t,e),null!=i&&i.apply(t,e),s}):void 0},t.bindAppEvents=function(e){return t.bindEventMap(e,e.app,e.appEvents)},t.bindDataEvents=function(n){var i,r,o,s,l,a;if(r=n.dataEvents){"function"==typeof r&&(r=n.dataEvents());for(o in r)i=r[o],l=o.split(" "),2>l.length?e("Data event must specify target object, ex: {'change collection': 'handler'}"):(a=l.pop(),a="this"===a||"@"===a?n:n[a],a?(s=l.join(" "),t.bindEvent(n,a,s,i)):e("Target object not found for data event '"+o+"'",n));return n}},t.bindEvent=function(){var t;return t=arguments.length>=1?a.call(arguments,0):[],t.push("listenTo"),i.apply(null,t)},t.unbindEvent=function(){var t;return t=arguments.length>=1?a.call(arguments,0):[],t.push("stopListening"),i.apply(null,t)},t.bindEventMap=function(){var t;return t=arguments.length>=1?a.call(arguments,0):[],t.push("listenTo"),r.apply(null,t)},t.unbindEventMap=function(){var t;return t=arguments.length>=1?a.call(arguments,0):[],t.push("stopListening"),r.apply(null,t)},i=function(t,n,i,r,o){return n&&t&&i&&o?("string"==typeof r&&(r=t[r]),"function"!=typeof r?(e("callback for `'"+i+"'` not found",t,n,r),void 0):t[o](n,i,r)):void 0},r=function(t,e,n,r){var o,s;if("function"==typeof n&&(n=n.call(t)),n){for(s in n)o=n[s],i(t,e,s,o,r);return t}}}).call(this);