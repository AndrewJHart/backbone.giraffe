(function(){var t,e,i,n,r,s,o=function(t,e){return function(){return t.apply(e,arguments)}},a={}.hasOwnProperty,p=function(t,e){function i(){this.constructor=t}for(var n in e)a.call(e,n)&&(t[n]=e[n]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},l=[].slice;"undefined"!=typeof global&&null!==global?(e=require("backbone"),t=require("jQuery")):(e=window.Backbone,t=window.$),e.Giraffe=i={app:null,apps:{},views:{}},"undefined"!=typeof window&&null!==window&&(window.Giraffe=i),n=function(){var t,e;return"undefined"!=typeof console&&null!==console?null!=(t=console.error)?t.apply(console,(e=["Backbone.Giraffe error:"]).concat.apply(e,arguments)):void 0:void 0},i.View=function(e){function r(t){null==t&&(t={}),this.render=o(this.render,this),_.defaults(t,i.View.defaultOptions),this.app||(this.app=t.app||i.app),i.bindEventMap(this,this.app,this.appEvents),this.children=[],this.parent=null,this._renderedOnce=!1,this._isAttached=!1,this._createEventsFromUIElements(),this._wrapInitialize(),t.templateStrategy?i.View.setTemplateStrategy(t.templateStrategy,this):"string"==typeof this.templateStrategy&&i.View.setTemplateStrategy(this.templateStrategy),r.__super__.constructor.call(this,t)}return p(r,e),r.defaultOptions={disposeOnDetach:!0,alwaysRender:!1,saveScrollPosition:!1,documentTitle:null,templateStrategy:null},r.prototype._wrapInitialize=function(){var t=this;return this.initialize=_.wrap(this.initialize,function(e){return t._cache(),t.$el.attr("data-view-cid",t.cid),e.apply(t,Array.prototype.slice.call(arguments,1)),t._bindDataEvents()})},r.prototype._attachMethods=["append","prepend","html","after","before","insertAfter","insertBefore"],r.prototype._siblingAttachMethods=["after","before","insertAfter","insertBefore"],r.prototype.attachTo=function(t,e){var r,s,o,a,p,l;return a=(null!=e?e.method:void 0)||"append",o=(null!=e?e.forceRender:void 0)||!1,l=(null!=e?e.suppressRender:void 0)||!1,this.$el?(_.contains(this._attachMethods,a)||(n("The attach method '"+a+"' isn't supported. Defaulting to 'append'.",a,this._attachMethods),a="append"),s=i.View.to$El(t),r=_.contains(this._siblingAttachMethods,a)?s.parent():s,"insertAfter"===a&&(a="after"),"insertBefore"===a&&(a="before"),1!==s.length?(n("Expected to render to a single element but found "+s.length,t),this):(this.detach(!0),this.setParent(i.View.getClosestView(r)),"html"===a&&(i.View.detachByEl(s),s.empty()),s[a](this.$el),this._isAttached=!0,p=!l&&(!this._renderedOnce||o||this.options.alwaysRender),p&&this.render(e),this.options.saveScrollPosition&&this._loadScrollPosition(),null!=this.options.documentTitle&&(document.title=this.options.documentTitle),this)):(n("Trying to attach a disposed view. Make a new one or create the view with the option `disposeOnDetach` set to false.",this),this)},r.prototype.attach=function(t,e){var i;return(null!=e?e.el:void 0)?(i=this.$el.find(e.el),i.length?t.attachTo(i,e):this.$el.is(e.el)?t.attachTo(this.$el,e):n("Attempting to attach to an element that doesn't exist inside this view!",e,t,this)):t.attachTo(this.$el,e),this},r.prototype.beforeRender=function(){},r.prototype.render=function(t){return this.beforeRender.apply(this,arguments),this._renderedOnce=!0,this.detachChildren(null!=t?t.preserve:void 0),this.$el.empty().html(this.templateStrategy()||""),this._cacheUiElements(),this.afterRender.apply(this,arguments),this},r.prototype.afterRender=function(){},r.prototype.templateStrategy=function(){return""},r.prototype.template=null,r.prototype.serialize=function(){return this},r.prototype.detach=function(t){return null==t&&(t=!1),this._isAttached?(this._isAttached=!1,this.options.saveScrollPosition&&this._saveScrollPosition(),this.$el.detach(),this.options.disposeOnDetach&&!t&&this.dispose(),this):this},r.prototype.detachChildren=function(t){var e,i,n,r;for(null==t&&(t=!1),r=this.children.slice(),i=0,n=r.length;n>i;i++)e=r[i],"function"==typeof e.detach&&e.detach(t);return this},r.prototype._saveScrollPosition=function(){return this._scrollPosition=this._getScrollPositionEl().scrollTop()},r.prototype._loadScrollPosition=function(){return null!=this._scrollPosition?this._getScrollPositionEl().scrollTop(this._scrollPosition):void 0},r.prototype._getScrollPositionEl=function(){switch(typeof this.options.saveScrollPosition){case"string":return this.$(this.options.saveScrollPosition).first();case"object":return t(this.options.saveScrollPosition);default:return this.$el}},r.prototype.addChild=function(t){var e;return _.contains(this.children,t)||(null!=(e=t.parent)&&e.removeChild(t,!0),t.parent=this,this.children.push(t)),this},r.prototype.addChildren=function(t){var e,i,n;for(i=0,n=t.length;n>i;i++)e=t[i],this.addChild(e);return this},r.prototype.removeChild=function(t,e){var i;return null==e&&(e=!1),i=_.indexOf(this.children,t),i>-1&&(this.children.splice(i,1),t.parent=null,e?"function"==typeof t.detach&&t.detach(!0):"function"==typeof t.dispose&&t.dispose()),this},r.prototype.removeChildren=function(t){var e,i,n,r;for(null==t&&(t=!1),r=this.children.slice(),i=0,n=r.length;n>i;i++)e=r[i],this.removeChild(e,t);return this},r.prototype.setParent=function(t){return t?t.addChild(this):this.parent&&(this.parent.removeChild(this,!0),this.parent=null),this},r.prototype.isAttached=function(e){return e?e.$el?this.parent===e:this.$el.parent().is(e):t(document).find(this.$el).length>0},r.prototype.ui=null,r.prototype._cacheUiElements=function(){var t,e,i;if(this.ui){i=this.ui;for(t in i)e=i[t],this[t]=this.$(e)}return this},r.prototype._uncacheUiElements=function(){var t,e,i;if(!this.ui)return this;i=this.ui;for(t in i)e=i[t],delete this[t];return this},r.prototype._createEventsFromUIElements=function(){var t,e,i,n;if(!this.events||!this.ui)return this;"function"==typeof this.ui&&(this.ui=this.ui()),"function"==typeof this.events&&(this.events=this.events()),n=this.events;for(t in n)e=n[t],i=this._getEventKeyFromUIElements(t),i!==t&&(delete this.events[t],this.events[i]=e);return this},r.prototype._getEventKeyFromUIElements=function(t){var e,i,n,r;return n=t.split(" "),i=n.length,2>i?t:(e=n[i-1],r=this.ui[e],r?(n[i-1]=r,n.join(" ")):t)},r.prototype._bindDataEvents=function(){var t,e,r,s,o,a;if(!this.dataEvents)return this;"function"==typeof this.dataEvents&&(this.dataEvents=this.dataEvents()),a=this.dataEvents;for(e in a)t=a[e],s=e.split(" "),2>s.length?n("Data event must specify target object, ex: {'change collection': 'handler'}"):(o=s.pop(),o="this"===o||"@"===o?this:this[o],o?(r=s.join(" "),i.bindEvent(this,o,r,t)):n("Unknown taget object "+o+" for data event",e));return this},r.prototype._uncache=function(){return delete i.views[this.cid],this},r.prototype._cache=function(){return i.views[this.cid]=this,this},r.prototype.invoke=function(){var t,e,i;for(e=arguments[0],t=arguments.length>=2?l.call(arguments,1):[],i=this;i&&!i[e];)i=i.parent;return(null!=i?i[e]:void 0)?i[e].apply(i,t):(n("No such method in view hierarchy",e,t,this),!0)},r.prototype.appEvents=null,r.prototype.dispose=function(){return i.dispose(this,function(){return this.setParent(null),this.removeChildren(),this._uncacheUiElements(),this._uncache(),this.remove(),this.$el=null})},r.detachByEl=function(t,e){var n,r,s,o;for(null==e&&(e=!1),r=i.View.to$El(t);(n=r.find("[data-view-cid]:first")).length;)s=n.attr("data-view-cid"),o=i.View.getByCid(s),o.detach(e);return this},r.getClosestView=function(t){var e,n;return e=i.View.to$El(t),n=e.closest("[data-view-cid]").attr("data-view-cid"),i.View.getByCid(n)},r.getByCid=function(t){return i.views[t]},r.to$El=function(e){return(null!=e?e.$el:void 0)||(e instanceof t?e:t(e))},r.setDocumentEvents=function(e){var n,r,s,o;for("string"==typeof e&&(e=e.split(" ")),_.isArray(e)||(e=[e]),e=_.compact(e),i.View.removeDocumentEvents(),i.View._currentDocumentEvents=e,o=[],r=0,s=e.length;s>r;r++)n=e[r],o.push(function(e){return t(document).on(e,"[data-gf-"+e+"]",function(n){var r,s,o;return r=t(n.target).closest("[data-gf-"+e+"]"),s=r.attr("data-gf-"+e),o=i.View.getClosestView(r),o.invoke(s,n)})}(n));return o},r.removeDocumentEvents=function(){var e,n,r,s,o;if(null!=(s=i.View._currentDocumentEvents)?s.length:void 0){for(o=i.View._currentDocumentEvents,n=0,r=o.length;r>n;n++)e=o[n],t(document).off(e,"[data-gf-"+e+"]");return i.View._currentDocumentEvents=null}},r.setTemplateStrategy=function(e,n){var r;if("function"==typeof e)r=e;else switch(e){case"underscore-template-selector":r=function(){var e,i=this;if(!this.template)return"";if(!this._templateFn)switch(typeof this.template){case"string":e=this.template,this._templateFn=_.template(t(e).html()||"");break;case"function":this._templateFn=function(n){return e=i.template(),_.template(t(e).html()||"",n)};break;default:throw Error("this.template must be string or function")}return this._templateFn(this.serialize.apply(this,arguments))};break;case"underscore-template":r=function(){var t=this;if(!this.template)return"";if(!this._templateFn)switch(typeof this.template){case"string":this._templateFn=_.template(this.template);break;case"function":this._templateFn=function(e){return _.template(t.template(),e)};break;default:throw Error("this.template must be string or function")}return this._templateFn(this.serialize.apply(this,arguments))};break;case"jst":r=function(){var t;if(!this.template)return"";if(!this._templateFn)switch(typeof this.template){case"string":t=this.template,this._templateFn=function(){return t};break;case"function":this._templateFn=this.template;break;default:throw Error("this.template must be string or function")}return this._templateFn(this.serialize.apply(this,arguments))};break;default:throw Error("Unrecognized template strategy: "+e)}return n?n.templateStrategy=r:i.View.prototype.templateStrategy=r},r}(e.View),i.View.setTemplateStrategy("underscore-template-selector"),i.View.setDocumentEvents(["click","change"]),i.App=function(e){function r(e){var n=this;this.app=this,(null!=e?e.routes:void 0)&&(this.routes=e.routes),this._initializers=[],this.started=!1,t(window).unload(function(){return n.dispose()}),r.__super__.constructor.apply(this,arguments),this.routes&&(this.router=new i.Router({app:this,triggers:this.routes}))}return p(r,e),r.prototype._cache=function(){var t;return null==i.app&&(i.app=this),this._name=(null!=(t=this.options)?t.name:void 0)||this.cid,i.apps[this._name]=this,this.$el.attr("data-gf-app",this._name),r.__super__._cache.apply(this,arguments)},r.prototype._uncache=function(){return i.app===this&&(i.app=null),delete i.apps[this._name],r.__super__._uncache.apply(this,arguments)},r.prototype.routes=null,r.prototype.addInitializer=function(t){return this.started?t.call(this,this.options):this._initializers.push(t),this},r.prototype.start=function(t){var e,i=this;return null==t&&(t={}),this.trigger("app:initializing",t),e=function(r){var s;return r?n(r):(s=i._initializers.shift(),s?2===s.length?s.call(i,t,e):(s.call(i,t),e()):(_.extend(i.options,t),i.started=!0,i.trigger("app:initialized",t)))},e(),this},r}(i.View),i.Router=function(t){function r(t){return null==t&&(t={}),this.app=t.app||i.app,this.app?(this.app.addChild(this),i.bindEventMap(this,this.app,this.appEvents),t.triggers&&(this.triggers=t.triggers),"function"==typeof this.triggers&&(this.triggers=this.triggers()),this.triggers?(t.parentRouter&&(this.parentRouter=t.parentRouter),t.namespace?this.namespace=t.namespace:this.namespace||(this.namespace=i.Router.defaultNamespace),this._routes={},this._bindTriggers(),r.__super__.constructor.apply(this,arguments),void 0):n("Giraffe routers require a `triggers` map of routes to app events.")):n("Giraffe routers require an app! Please create an instance of Giraffe.App before creating a router.")}return p(r,t),r.defaultNamespace="",r.prototype._fullNamespace=function(){return this.parentRouter?this.parentRouter._fullNamespace()+"/"+this.namespace:this.namespace},r.prototype.triggers=null,r.prototype.reload=function(t){return t&&(e.history.stop(),window.location=t),window.location.reload()},r.prototype._bindTriggers=function(){var t,e,i,r,s,o=this;this.triggers||n("Expected router to implement `triggers` hash in the form {route: appEvent}"),e=this._fullNamespace(),e.length>0&&(e+="/"),s=this.triggers,r=function(t,e,i){var n;return 0===_.indexOf(e,"-> ")?n=function(){var t;return t=e.slice(3),o.navigate(t,{trigger:!0})}:0===_.indexOf(e,"=> ")?n=function(){var t;return t=e.slice(3),o.navigate(i+t,{trigger:!0})}:(t=i+t,n=function(){var i,n;return i=arguments.length>=1?l.call(arguments,0):[],(n=o.app).trigger.apply(n,[e].concat(l.call(i),[t]))},o._registerRoute(e,t)),o.route(t,e,n)};for(i in s)t=s[i],r(i,t,e);return this},r.prototype.cause=function(t,i){var n;return n=this.getRoute(t,i),null!=n?e.history.navigate(n,{trigger:!0}):this.app.trigger(t,i)},r.prototype.isCaused=function(t,i){var n;return n=this.getRoute(t,i),null!=n?e.history._hasPushState?window.location.pathname.slice(1)===n:window.location.hash===n:!1},r.prototype.getRoute=function(t,i){var n;return n=this._routes[t],null!=n?(n=this._reverseHash(n,i),n?e.history._hasPushState?n:"#"+n:""===n?"":null):null},r.prototype._registerRoute=function(t,e){return this._routes[t]=e},r.prototype._reverseHash=function(t,i){var n,r,s,o,a,p,l;if(!i)return t;if(o=/:(\w+)\b/g,s=t.match(o))for(p=0,l=s.length;l>p;p++)r=s[p],n=r.slice(1),a=i instanceof e.Model?i.get(n):_.isObject(i)?i[n]:i,t=t.replace(RegExp(""+r,"g"),a);return t},r.prototype.appEvents=null,r.prototype.dispose=function(){return i.dispose(this,function(){})},r}(e.Router),i.Model=function(t){function e(t,n){this.app||(this.app=(null!=n?n.app:void 0)||i.app),i.bindEventMap(this,this.app,this.appEvents),e.__super__.constructor.apply(this,arguments)}return p(e,t),e.prototype.appEvents=null,e.prototype.dispose=function(){return i.dispose(this,function(){var t;return null!=(t=this.collection)?t.remove(this):void 0})},e}(e.Model),i.Collection=function(t){function e(t,n){this.app||(this.app=(null!=n?n.app:void 0)||i.app),i.bindEventMap(this,this.app,this.appEvents),e.__super__.constructor.apply(this,arguments)}return p(e,t),e.prototype.model=i.Model,e.prototype.appEvents=null,e.prototype.dispose=function(){return i.dispose(this,function(){var t,e,i,n,r;for(n=this.models,r=[],e=0,i=n.length;i>e;e++)t=n[e],r.push(t.dispose());return r})},e}(e.Collection),i.dispose=function(){var t,e,i;return i=arguments[0],e=arguments[1],t=arguments.length>=3?l.call(arguments,2):[],"function"==typeof i.trigger&&i.trigger.apply(i,["disposing",i].concat(l.call(t))),null!=e&&e.apply(i,t),"function"==typeof i.stopListening&&i.stopListening(),i.app=null,"function"==typeof i.trigger&&i.trigger.apply(i,["disposed",i].concat(l.call(t))),i},i.bindEvent=function(){var t;return t=arguments.length>=1?l.call(arguments,0):[],r.apply(null,t.concat("listenTo"))},i.unbindEvent=function(){var t;return t=arguments.length>=1?l.call(arguments,0):[],r.apply(null,t.concat("stopListening"))},i.bindEventMap=function(){var t;return t=arguments.length>=1?l.call(arguments,0):[],s.apply(null,t.concat("listenTo"))},i.unbindEventMap=function(){var t;return t=arguments.length>=1?l.call(arguments,0):[],s.apply(null,t.concat("stopListening"))},r=function(t,e,i,r,s){return e&&t&&i&&s?("string"==typeof r&&(r=t[r]),"function"!=typeof r?(n("callback for `'"+i+"'` not found",t,e,r),void 0):t[s](e,i,r)):void 0},s=function(t,e,i,n){var s,o;if("function"==typeof i&&(i=i()),i){for(o in i)s=i[o],r(t,e,o,s,n);return null}}}).call(this);