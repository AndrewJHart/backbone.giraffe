<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <title>Giraffe - Barc's Backbone Framework</title>

    <!-- Stylesheets -->
    <link rel='stylesheet' type='text/css' href='css/style.css' />

    <!-- Scripts -->
    <!--[if lt IE 9]><script type="text/javascript" src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
</head>
<body>
  <div id="page-wrapper">
    <div class="row">

      <!-- Sidebar -->
      <section id="sidebar" class="col sidebar">
        <h2><a href="index.html#">Backbone.Giraffe</a></h2>
        <ul>
          <li><a href="index.html#h-download">Download</a></li>
          <li><a href="https://github.com/barc/backbone.giraffe">Github</a></li>
        </ul>
        
        <h2 id='h-apiapihtml'><a href="api.html">API</a></h2>
<h2 id='h-examplesindexhtml'><a href="index.html">Examples</a></h2>
<ul>
<li><a href="viewBasics.html">View Basics</a></li>
<li><a href="templateStrategies.html">Template Strategies</a></li>
<li><a href="lifecycleManagement.html">Lifecycle Management</a></li>
<li><a href="appEvents.html">App Events</a></li>
<li><a href="routersAndAppEvents.html">Routers and App Events</a></li>
<li><a href="appInitialization.html">App Initialization</a></li>
<li><a href="documentEvents.html">View Document Events</a></li>
<li><a href="viewUI.html">View UI</a></li>
<li><a href="menuExample.html">Menu Example</a></li>
<li><a href="viewFlexibility.html">View Flexibility</a></li>
<li><a href="collectionView.html">Collection View</a></li>
<li><a href="http://iamthe35th.github.io/todomvc/labs/architecture-examples/backbone.giraffe/index.html"><em>TodoMVC on Github</em></a></li>
</ul>

        <h3><a href='http://barc.com' class='barc'>@Barc</a></h3>
      </section>

      <!-- Main Body -->
      <article id="content" class="col content">
        <a href='index.html'>
          <img id="logo" src="img/logo.png" />
        </a>
        <h1 id='h-implement-collectionview'>Implement CollectionView</h1>
<p>CollectionView and ItemView are classes often found in other Backbone
frameworks. This example details how to implement this pattern in <strong>Giraffe</strong>
by rendering a collection of savory colored fruits.</p>
<p><div class='section-example'><h2 id='h-collection-and-model'>Collection and Model</h2>
<p>Defining the model and collection is the same as in <strong>Backbone</strong>.
Any <strong>Giraffe.Model</strong> is automatically tracked for dispoal when assigned to
a <strong>Giraffe.View</strong>.</p>
<pre><code class="js"><span class="keyword">var</span> Fruit = Giraffe.Model.extend({
  defaults: {
    name: <span class="literal">null</span>,
    color: <span class="literal">null</span>
  }
});

<span class="keyword">var</span> Fruits = Giraffe.Collection.extend({
  model: Fruit,
  comparator: <span class="string">'name'</span>
});</code></pre>
<h2 id='h-item-view'>Item View</h2>
<p>In <strong>Giraffe</strong> views are composable. A collection view can be implemented
simply by attaching one or more views to a view.</p>
<pre><code class="js"><span class="keyword">var</span> FruitView = Giraffe.View.extend({
  template: <span class="string">'#fruit-template'</span>,

  initialize: <span class="function"><span class="keyword">function</span><span class="params">()</span> {</span>
    <span class="keyword">this</span>.$el.css(<span class="string">'background-color'</span>, <span class="keyword">this</span>.model.get(<span class="string">'color'</span>));
  },

  serialize: <span class="function"><span class="keyword">function</span><span class="params">()</span> {</span>
    <span class="keyword">return</span> <span class="keyword">this</span>.model.toJSON()
  },</code></pre>
<p>We could cheat and call <code>this.dispose()</code> here. By modifying the collection
instead, any view observing the collection is notified.</p>
<pre><code class="js">  onClone: <span class="function"><span class="keyword">function</span><span class="params">()</span> {</span>
    <span class="keyword">this</span>.model.collection.add(<span class="keyword">this</span>.model.clone());
  },

  onDelete: <span class="function"><span class="keyword">function</span><span class="params">()</span> {</span>
    <span class="comment">// Giraffe method which also removes it from the collection</span>
    <span class="keyword">this</span>.model.dispose();
  }
});</code></pre>
<p>Add a delete and clone button to manually modify the collection.</p>
<pre><code class="html"><span class="tag">&lt;<span class="title">script</span> <span class="attribute">id</span>=<span class="value">'fruit-template'</span> <span class="attribute">type</span>=<span class="value">'text/template'</span>&gt;</span>
  <span class="tag">&lt;<span class="title">div</span> <span class="attribute">class</span>=<span class="value">'fruit-view'</span>&gt;</span>
    <span class="tag">&lt;<span class="title">h2</span>&gt;</span><span class="javascript">&lt;%= name %&gt;</span><span class="tag">&lt;/<span class="title">h2</span>&gt;</span>
    <span class="tag">&lt;<span class="title">button</span> <span class="attribute">data-gf-click</span>=<span class="value">'onDelete'</span>&gt;</span>delete<span class="tag">&lt;/<span class="title">button</span>&gt;</span>
    <span class="tag">&lt;<span class="title">button</span> <span class="attribute">data-gf-click</span>=<span class="value">'onClone'</span>&gt;</span>clone<span class="tag">&lt;/<span class="title">button</span>&gt;</span>
  <span class="tag">&lt;/<span class="title">div</span>&gt;</span>
<span class="tag">&lt;/<span class="title">script</span>&gt;</span></code></pre>
<h2 id='h-collection-view'>Collection View</h2>
<p>A collection view reacts to changes on its collection, thus the
view needs handlers for <code>add</code> and <code>remove</code> events. The
<code>dataEvents</code> property facilitates assigning handlers.</p>
<pre><code class="js"><span class="keyword">var</span> FruitsView = Giraffe.View.extend({
  dataEvents: {
    <span class="string">'add collection'</span>: <span class="string">'onAddItem'</span>,
    <span class="string">'remove collection'</span>: <span class="string">'onRemoveItem'</span>
  },</code></pre>
<div class='note'>
  <p>
    Consider <code>dataEvents</code> property unstable. One of our smart interns found a common
    use case where events do not trigger. That is, if you modify a model/collection
    in the <code>initialize</code> method, event listeners have not yet been assigned and
    expected events do not fire.
  </p>
  <p>
    We may obsolete this property altogether as it could lead to <a href="https://en.wikipedia.org/wiki/Principle_of_least_astonishment">astonishment</a>.
  </p>
</div>


<p>Let&#39;s do something more than just appending the item to the collection. Add a new item after the view which was just
clicked.</p>
<pre><code class="js">  getAttachOptions: <span class="function"><span class="keyword">function</span><span class="params">(fruit)</span> {</span>
    <span class="keyword">var</span> index = <span class="keyword">this</span>.collection.indexOf(fruit);
    <span class="keyword">var</span> options = {method: <span class="string">'prepend'</span>};
    <span class="keyword">if</span> (index &gt; <span class="number">0</span>) {
      options.method = <span class="string">'after'</span>;
      <span class="keyword">var</span> pred = <span class="keyword">this</span>.collection.at(index - <span class="number">1</span>);
      <span class="keyword">var</span> predView = _.findWhere(<span class="keyword">this</span>.children, {model: pred});
      options.el = predView;
    }
    <span class="keyword">return</span> options;
  },

  onAddItem: <span class="function"><span class="keyword">function</span><span class="params">(fruit)</span> {</span>
    <span class="keyword">var</span> itemView = <span class="keyword">new</span> FruitView({model: fruit});
    <span class="keyword">var</span> options = <span class="keyword">this</span>.getAttachOptions(fruit);
    <span class="keyword">this</span>.attach(itemView, options);
  },

  onRemoveItem: <span class="function"><span class="keyword">function</span><span class="params">(fruit)</span> {</span>
    <span class="keyword">var</span> itemView = _.findWhere(<span class="keyword">this</span>.children, {model: fruit});
    itemView.dispose();
  },</code></pre>
<p>Child items must be added <em>after</em> this collection view has rendered itself.</p>
<pre><code class="js">  afterRender: <span class="function"><span class="keyword">function</span><span class="params">()</span> {</span>
    <span class="keyword">var</span> my = <span class="keyword">this</span>;
    <span class="keyword">this</span>.collection.each(<span class="function"><span class="keyword">function</span><span class="params">(item)</span> {</span>
      my.onAddItem(item, my.collection);
    });
  }
});</code></pre>
<p>Let&#39;s create tasty fruits and attach the collection view to the page.</p>
<pre><code class="js"><span class="keyword">var</span> fruits = <span class="keyword">new</span> Fruits([
  {name: <span class="string">'Apple'</span>, color: <span class="string">'#0F0'</span>},
  {name: <span class="string">'Banana'</span>, color: <span class="string">'#FF0'</span>},
  {name: <span class="string">'Orange'</span>, color: <span class="string">'#FF7F00'</span>},
  {name: <span class="string">'Pink Grapefruit'</span>, color: <span class="string">'#C5363A'</span>}
]);

<span class="keyword">var</span> fruitsView = <span class="keyword">new</span> FruitsView({
  collection: fruits
});

fruitsView.attachTo(<span class="string">'body'</span>);</code></pre>
<p>Voila! Fruitty-tutty</p>
<div id="collectionview0_tabs" class="tabs">
  <ul>
    <li class="active">
  <a href="#collectionview0result-tab" rel="collectionview0result-tab">
    result
  </a>
</li><li>
  <a href="#collectionview0scriptjs-tab" rel="collectionview0scriptjs-tab">
    script.js
  </a>
</li><li>
  <a href="#collectionview0markuphtml-tab" rel="collectionview0markuphtml-tab">
    markup.html
  </a>
</li><li>
  <a href="#collectionview0stylecss-tab" rel="collectionview0stylecss-tab">
    style.css
  </a>
</li>
  </ul>
</div>
<div id="collectionview0_tabs_content" class="tabs_content">
  <div id="collectionview0result-tab" class="tab_content">
  <iframe id="collectionview0" src="assets/collectionView0.html" class="result"  style='height: 340px'></iframe>
</div><div id="collectionview0scriptjs-tab" class="tab_content">
  <pre><code class="language-js"><span class="keyword">var</span> Fruit = Giraffe.Model.extend({
  defaults: {
    name: <span class="literal">null</span>,
    color: <span class="literal">null</span>
  }
});

<span class="keyword">var</span> Fruits = Giraffe.Collection.extend({
  model: Fruit,
  comparator: <span class="string">'name'</span>
});

<span class="keyword">var</span> FruitView = Giraffe.View.extend({
  template: <span class="string">'#fruit-template'</span>,

  initialize: <span class="function"><span class="keyword">function</span><span class="params">()</span> {</span>
    <span class="keyword">this</span>.$el.css(<span class="string">'background-color'</span>, <span class="keyword">this</span>.model.get(<span class="string">'color'</span>));
  },

  serialize: <span class="function"><span class="keyword">function</span><span class="params">()</span> {</span>
    <span class="keyword">return</span> <span class="keyword">this</span>.model.toJSON()
  },

  onClone: <span class="function"><span class="keyword">function</span><span class="params">()</span> {</span>
    <span class="keyword">this</span>.model.collection.add(<span class="keyword">this</span>.model.clone());
  },

  onDelete: <span class="function"><span class="keyword">function</span><span class="params">()</span> {</span>
    <span class="comment">// Giraffe method which also removes it from the collection</span>
    <span class="keyword">this</span>.model.dispose();
  }
});

<span class="keyword">var</span> FruitsView = Giraffe.View.extend({
  dataEvents: {
    <span class="string">'add collection'</span>: <span class="string">'onAddItem'</span>,
    <span class="string">'remove collection'</span>: <span class="string">'onRemoveItem'</span>
  },

  getAttachOptions: <span class="function"><span class="keyword">function</span><span class="params">(fruit)</span> {</span>
    <span class="keyword">var</span> index = <span class="keyword">this</span>.collection.indexOf(fruit);
    <span class="keyword">var</span> options = {
      method: <span class="string">'prepend'</span>
    };
    <span class="keyword">if</span> (index &gt; <span class="number">0</span>) {
      options.method = <span class="string">'after'</span>;
      <span class="keyword">var</span> pred = <span class="keyword">this</span>.collection.at(index - <span class="number">1</span>);
      <span class="keyword">var</span> predView = _.findWhere(<span class="keyword">this</span>.children, {
        model: pred
      });
      options.el = predView;
    }
    <span class="keyword">return</span> options;
  },

  onAddItem: <span class="function"><span class="keyword">function</span><span class="params">(fruit)</span> {</span>
    <span class="keyword">var</span> itemView = <span class="keyword">new</span> FruitView({
      model: fruit
    });
    <span class="keyword">var</span> options = <span class="keyword">this</span>.getAttachOptions(fruit);
    <span class="keyword">this</span>.attach(itemView, options);
  },

  onRemoveItem: <span class="function"><span class="keyword">function</span><span class="params">(fruit)</span> {</span>
    <span class="keyword">var</span> itemView = _.findWhere(<span class="keyword">this</span>.children, {
      model: fruit
    });
    itemView.dispose();
  },

  afterRender: <span class="function"><span class="keyword">function</span><span class="params">()</span> {</span>
    <span class="keyword">var</span> my = <span class="keyword">this</span>;
    <span class="keyword">this</span>.collection.each(<span class="function"><span class="keyword">function</span><span class="params">(item)</span> {</span>
      my.onAddItem(item, my.collection);
    });
  }
});

<span class="keyword">var</span> fruits = <span class="keyword">new</span> Fruits([{
  name: <span class="string">'Apple'</span>,
  color: <span class="string">'#0F0'</span>
}, {
  name: <span class="string">'Banana'</span>,
  color: <span class="string">'#FF0'</span>
}, {
  name: <span class="string">'Orange'</span>,
  color: <span class="string">'#FF7F00'</span>
}, {
  name: <span class="string">'Pink Grapefruit'</span>,
  color: <span class="string">'#C5363A'</span>
}]);

<span class="keyword">var</span> fruitsView = <span class="keyword">new</span> FruitsView({
  collection: fruits
});

fruitsView.attachTo(<span class="string">'body'</span>);</code></pre>
</div><div id="collectionview0markuphtml-tab" class="tab_content">
  <pre><code class="language-html"><span class="doctype">&lt;!DOCTYPE html&gt;</span>
<span class="tag">&lt;<span class="title">html</span>&gt;</span>

<span class="tag">&lt;<span class="title">head</span>&gt;</span>
  <span class="tag">&lt;<span class="title">link</span> <span class="attribute">rel</span>=<span class="value">'stylesheet'</span> <span class="attribute">type</span>=<span class="value">'text/css'</span> <span class="attribute">href</span>=<span class="value">'../css/reset.css'</span> /&gt;</span>
  <span class="tag">&lt;<span class="title">link</span> <span class="attribute">rel</span>=<span class="value">'stylesheet'</span> <span class="attribute">type</span>=<span class="value">'text/css'</span> <span class="attribute">href</span>=<span class="value">'collectionview0-style.css'</span> /&gt;</span>
<span class="tag">&lt;/<span class="title">head</span>&gt;</span>

<span class="tag">&lt;<span class="title">body</span>&gt;</span>
  <span class="tag">&lt;<span class="title">script</span> <span class="attribute">id</span>=<span class="value">'fruit-template'</span> <span class="attribute">type</span>=<span class="value">'text/template'</span>&gt;</span>
    <span class="tag">&lt; <span class="attribute">div</span> <span class="attribute">class</span> = '<span class="attribute">fruit-view</span>' &gt;</span> <span class="tag">&lt; <span class="attribute">h2</span> &gt;</span> <span class="javascript">&lt;%= name %&gt;</span> <span class="tag">&lt; /<span class="attribute">h2</span>&gt;</span>
    <span class="tag">&lt;<span class="title">button</span> <span class="attribute">data-gf-click</span>=<span class="value">'onDelete'</span>&gt;</span>delete<span class="tag">&lt;/<span class="title">button</span> &gt;</span> <span class="tag">&lt; <span class="attribute">button</span> <span class="attribute">data</span> <span class="attribute">-</span> <span class="attribute">gf</span> <span class="attribute">-</span> <span class="attribute">click</span> = '<span class="attribute">onClone</span>' &gt;</span> clone <span class="tag">&lt; /<span class="attribute">button</span>&gt;</span>
  <span class="tag">&lt;/<span class="title">div</span> &gt;</span>
  <span class="tag">&lt;/<span class="title">script</span>&gt;</span>

  <span class="tag">&lt;<span class="title">script</span> <span class="attribute">src</span>=<span class="value">"http://code.jquery.com/jquery-1.9.1.min.js"</span>&gt;</span><span class="tag">&lt;/<span class="title">script</span>&gt;</span>
  <span class="tag">&lt;<span class="title">script</span> <span class="attribute">src</span>=<span class="value">"http://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.4.4/underscore-min.js"</span>&gt;</span><span class="tag">&lt;/<span class="title">script</span>&gt;</span>
  <span class="tag">&lt;<span class="title">script</span> <span class="attribute">src</span>=<span class="value">"http://cdnjs.cloudflare.com/ajax/libs/backbone.js/1.0.0/backbone-min.js"</span>&gt;</span><span class="tag">&lt;/<span class="title">script</span>&gt;</span>
  <span class="tag">&lt;<span class="title">script</span> <span class="attribute">src</span>=<span class="value">"../backbone.giraffe.js"</span> <span class="attribute">type</span>=<span class="value">"text/javascript"</span>&gt;</span><span class="javascript"></span><span class="tag">&lt;/<span class="title">script</span>&gt;</span>
  <span class="tag">&lt;<span class="title">script</span> <span class="attribute">type</span>=<span class="value">'text/javascript'</span> <span class="attribute">src</span>=<span class="value">'collectionview0-script.js'</span>&gt;</span><span class="javascript"></span><span class="tag">&lt;/<span class="title">script</span>&gt;</span>
<span class="tag">&lt;/<span class="title">body</span>&gt;</span>

<span class="tag">&lt;/<span class="title">html</span>&gt;</span>
</code></pre>
</div><div id="collectionview0stylecss-tab" class="tab_content">
  <pre><code class="language-css"><span class="tag">h2</span> <span class="rules">{
  <span class="rule"><span class="attribute">font-size</span>:<span class="value"> <span class="number">24</span>px</span></span>;
<span class="rule">}</span></span>
<span class="class">.fruit-view</span> <span class="rules">{
  <span class="rule"><span class="attribute">position</span>:<span class="value"> relative</span></span>;
  <span class="rule"><span class="attribute">padding</span>:<span class="value"> <span class="number">10</span>px</span></span>;
  <span class="rule"><span class="attribute">margin</span>:<span class="value"> <span class="number">10</span>px</span></span>;
<span class="rule">}</span></span></code></pre>
</div>
</div></div></p>

      </article>
    </div>
  </div>

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.0.0/jquery.min.js"></script>
  <script src="assets/tutdown.js"></script>
  <script>
  $(function() {
    $('.more-details').click(function() {
      $this = $(this);
      if ($this.hasClass('collapsed')) {
        $this.removeClass('collapsed');
        $this.addClass('uncollapsed');
      } else {
        $this.removeClass('uncollapsed');
        $this.addClass('collapsed');
      }
    });
  });
  </script>
  <script type="text/javascript"> 
    (function() { 
      var b = document.createElement("script"); b.type = "text/javascript"; b.async = true; 
      b.src = "https://barc.com/js/libs/barc/barc.js"; 
      var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(b, s); 
    })(); 
  </script>
  <script type="text/javascript">
    $('#sidebar a').each(function() {
      var 
        $a = $(this),
        href = window.location.href;
      if (href.indexOf && href.indexOf($a.attr('href')) > -1 && href.indexOf('#') === -1) // hacky to grab only example links
        $a.closest('li').addClass('active');
    });
  </script>
</body>
</html>

