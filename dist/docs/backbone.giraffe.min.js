(function(){var t,e,n,i,o,r,s,l,a,u,h=function(t,e){return function(){return t.apply(e,arguments)}},c={}.hasOwnProperty,p=function(t,e){function n(){this.constructor=t}for(var i in e)c.call(e,i)&&(t[i]=e[i]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},d=[].slice;t=window.$,s=window._,i=window.Backbone,i.Giraffe=window.Giraffe=o={version:"0.1.4",app:null,apps:{},views:{}},o.$window=n=t(window),o.$document=e=t(document),r=function(){var t,e;return"undefined"!=typeof console&&null!==console?null!=(t=console.error)?t.apply(console,(e=["Backbone.Giraffe error:"]).concat.apply(e,arguments)):void 0:void 0},o.View=function(n){function i(t){this.render=h(this.render,this),o.configure(this,t),this.children=[],this.parent=null,this._renderedOnce=!1,this._isAttached=!1,this._createEventsFromUIElements(),"string"==typeof this.templateStrategy&&o.View.setTemplateStrategy(this.templateStrategy,this),i.__super__.constructor.apply(this,arguments)}return p(i,n),i.defaultOptions={disposeOnDetach:!0},i.prototype.beforeInitialize=function(){return this._cache(),this.$el.attr("data-view-cid",this.cid),this.setParent(o.View.getClosestView(this.$el)),this._cacheUiElements()},i.prototype._attachMethods=["append","prepend","html","after","before","insertAfter","insertBefore"],i.prototype._siblingAttachMethods=["after","before","insertAfter","insertBefore"],i.prototype.attachTo=function(t,e){var n,i,l,a,u,h;return a=(null!=e?e.method:void 0)||"append",l=(null!=e?e.forceRender:void 0)||!1,h=(null!=e?e.suppressRender:void 0)||!1,this.$el?(s.contains(this._attachMethods,a)||(r("The attach method '"+a+"' isn't supported. Defaulting to 'append'.",a,this._attachMethods),a="append"),i=o.View.to$El(t),1!==i.length?(r("Expected to render to a single element but found "+i.length,t),this):(n=s.contains(this._siblingAttachMethods,a)?i.parent():i,"insertAfter"===a&&(a="after"),"insertBefore"===a&&(a="before"),this.detach(!0),this.setParent(o.View.getClosestView(n)),"html"===a&&(o.View.detachByEl(i),i.empty()),i[a](this.$el),this._isAttached=!0,u=!h&&(!this._renderedOnce||l||this.alwaysRender),u&&this.render(e),this.saveScrollPosition&&this._loadScrollPosition(),null!=this.documentTitle&&(document.title=this.documentTitle),this)):(r("Trying to attach a disposed view. Make a new one or create the view with the option `disposeOnDetach` set to false.",this),this)},i.prototype.attach=function(t,e){var n,i;if(i=null,null!=e?e.el:void 0){if(n=o.View.to$El(e.el,this.$el,!0),!n.length)return r("Attempting to attach to an element that doesn't exist inside this view!",e,t,this),this;i=n}else i=this.$el;return t.attachTo(i,e),this},i.prototype.render=function(t){var e;return this.beforeRender.apply(this,arguments),this._renderedOnce=!0,this.detachChildren(null!=t?t.preserve:void 0),e=this.templateStrategy.apply(this,arguments)||"",this.$el.empty()[0].innerHTML=e,this._cacheUiElements(),this.afterRender.apply(this,arguments),this},i.prototype.beforeRender=function(){},i.prototype.afterRender=function(){},i.prototype.templateStrategy=function(){return""},i.prototype.template=null,i.prototype.serialize=function(){return this},i.prototype.detach=function(t){return null==t&&(t=!1),this._isAttached?(this._isAttached=!1,this.saveScrollPosition&&this._saveScrollPosition(),this.$el.detach(),this.disposeOnDetach&&!t&&this.dispose(),this):this},i.prototype.detachChildren=function(t){var e,n,i,o;for(null==t&&(t=!1),o=this.children.slice(),n=0,i=o.length;i>n;n++)e=o[n],"function"==typeof e.detach&&e.detach(t);return this},i.prototype._saveScrollPosition=function(){return this._scrollPosition=this._getScrollPositionEl().scrollTop(),this},i.prototype._loadScrollPosition=function(){return null!=this._scrollPosition&&this._getScrollPositionEl().scrollTop(this._scrollPosition),this},i.prototype._getScrollPositionEl=function(){var t;return"boolean"==typeof this.saveScrollPosition||this.$el.is(this.saveScrollPosition)?this.$el:(t=o.View.to$El(this.saveScrollPosition,this.$el).first(),t.length?t:(t=o.View.to$El(this.saveScrollPosition).first(),t.length?t:this.$el))},i.prototype.addChild=function(t){var e;return s.contains(this.children,t)||(null!=(e=t.parent)&&e.removeChild(t,!0),t.parent=this,this.children.push(t)),this},i.prototype.addChildren=function(t){var e,n,i;for(n=0,i=t.length;i>n;n++)e=t[n],this.addChild(e);return this},i.prototype.removeChild=function(t,e){var n;return null==e&&(e=!1),n=s.indexOf(this.children,t),n>-1&&(this.children.splice(n,1),t.parent=null,e?"function"==typeof t.detach&&t.detach(!0):"function"==typeof t.dispose&&t.dispose()),this},i.prototype.removeChildren=function(t){var e,n,i,o;for(null==t&&(t=!1),o=this.children.slice(),n=0,i=o.length;i>n;n++)e=o[n],this.removeChild(e,t);return this},i.prototype.setParent=function(t){return t&&t!==this?t.addChild(this):this.parent&&(this.parent.removeChild(this,!0),this.parent=null),this},i.prototype.isAttached=function(t){return null!=t?t.$el?this.parent===t:this.$el.parent().is(t):e.find(this.$el).length>0},i.prototype.ui=null,i.prototype._cacheUiElements=function(){var t,e,n;if(this.ui){n=this.ui;for(t in n)e=n[t],this[t]=function(){switch(typeof e){case"string":return this.$(e);case"function":return e.call(this);default:return e}}.call(this)}return this},i.prototype._uncacheUiElements=function(){var t;if(this.ui)for(t in this.ui)delete this[t];return this},i.prototype._createEventsFromUIElements=function(){var t,e,n,i;if(!this.events||!this.ui)return this;"function"==typeof this.ui&&(this.ui=this.ui.call(this)),"function"==typeof this.events&&(this.events=this.events.call(this)),i=this.events;for(t in i)e=i[t],n=this._getEventKeyFromUIElements(t),n!==t&&(delete this.events[t],this.events[n]=e);return this},i.prototype._getEventKeyFromUIElements=function(t){var e,n,i,o;return i=t.split(" "),n=i.length,2>n?t:(e=i[n-1],o=this.ui[e],o?(i[n-1]=o,i.join(" ")):t)},i.prototype.dataEvents=null,i.prototype._uncache=function(){return delete o.views[this.cid],this},i.prototype._cache=function(){return o.views[this.cid]=this,this},i.prototype.invoke=function(){var t,e,n;for(e=arguments[0],t=arguments.length>=2?d.call(arguments,1):[],n=this;n&&!n[e];)n=n.parent;return(null!=n?n[e]:void 0)?n[e].apply(n,t):(r("No such method name in view hierarchy",e,t,this),!1)},i.prototype.appEvents=null,i.prototype.beforeDispose=function(){return this.setParent(null),this.removeChildren(),this._uncacheUiElements(),this._uncache(),this._isAttached=!1,this.$el?(this.remove(),this.$el=null):r("Disposed of a view that has already been disposed",this),this},i.detachByEl=function(t,e){var n,i,r,s;for(null==e&&(e=!1),i=o.View.to$El(t);(n=i.find("[data-view-cid]:first")).length;)r=n.attr("data-view-cid"),s=o.View.getByCid(r),s.detach(e);return this},i.getClosestView=function(t){var e,n;return e=o.View.to$El(t),n=e.closest("[data-view-cid]").attr("data-view-cid"),o.View.getByCid(n)},i.getByCid=function(t){return o.views[t]},i.to$El=function(e,n,i){var r;return null==i&&(i=!1),n?(r=o.View.to$El(n),(null!=e?e.$el:void 0)&&(e=e.$el),i&&r.is(e)?r:r.find(e)):(null!=e?e.$el:void 0)?e.$el:e instanceof t?e:t(e)},i.setDocumentEvents=function(n,i){var r,l,a,u,h,c;for(null==i&&(i=o.View._documentEventPrefix),i=i||"","string"==typeof n&&(n=n.split(" ")),s.isArray(n)||(n=[n]),n=s.compact(n),o.View.removeDocumentEvents(),o.View._currentDocumentEvents=n,o.View._documentEventPrefix=i,u=function(n,i,r){return e.on(n,r,function(e){var n,s,l;return n=t(e.target).closest(r),s=n.attr(i),l=o.View.getClosestView(n),l.invoke(s,e)})},h=0,c=n.length;c>h;h++)l=n[h],r=i+l,a="["+r+"]",u(l,r,a);return n},i.removeDocumentEvents=function(t){var n,i,r,s,l;if(null==t&&(t=o.View._documentEventPrefix),t=t||"",n=o.View._currentDocumentEvents,null!=n?n.length:void 0){for(s=0,l=n.length;l>s;s++)i=n[s],r="["+t+i+"]",e.off(i,r);return o.View._currentDocumentEvents=null}},i.setDocumentEventPrefix=function(t){return null==t&&(t=""),o.View.setDocumentEvents(o.View._currentDocumentEvents,t)},i.setTemplateStrategy=function(e,n){var i,l;if(i=typeof e,"function"===i)l=e;else{if("string"!==i)return r("Unrecognized template strategy",e);switch(e.toLowerCase()){case"underscore-template-selector":l=function(){var e,n=this;if(!this.template)return"";if(!this._templateFn)switch(typeof this.template){case"string":e=this.template,this._templateFn=s.template(t(e).html()||"");break;case"function":this._templateFn=function(i){return e=n.template(),s.template(t(e).html()||"",i)};break;default:throw Error("this.template must be string or function")}return this._templateFn(this.serialize.apply(this,arguments))};break;case"underscore-template":l=function(){var t=this;if(!this.template)return"";if(!this._templateFn)switch(typeof this.template){case"string":this._templateFn=s.template(this.template);break;case"function":this._templateFn=function(e){return s.template(t.template(),e)};break;default:throw Error("this.template must be string or function")}return this._templateFn(this.serialize.apply(this,arguments))};break;case"jst":l=function(){var t;if(!this.template)return"";if(!this._templateFn)switch(typeof this.template){case"string":t=this.template,this._templateFn=function(){return t};break;case"function":this._templateFn=this.template;break;default:throw Error("this.template must be string or function")}return this._templateFn(this.serialize.apply(this,arguments))};break;default:throw Error("Unrecognized template strategy: "+e)}}return n?n.templateStrategy=l:o.View.prototype.templateStrategy=l},i}(i.View),o.View.setTemplateStrategy("underscore-template-selector"),o.View.setDocumentEvents(["click","change"],"data-gf-"),o.App=function(t){function e(){this._onUnload=h(this._onUnload,this),this.app=this,e.__super__.constructor.apply(this,arguments)}return p(e,t),e.prototype._cache=function(){return null==o.app&&(o.app=this),o.apps[this.cid]=this,this.routes&&null==this.router&&(this.router=new o.Router({app:this,triggers:this.routes})),n.on("unload",this._onUnload),e.__super__._cache.apply(this,arguments)},e.prototype._uncache=function(){return o.app===this&&(o.app=null),delete o.apps[this.cid],this.router&&(this.router=null),n.off("unload",this._onUnload),e.__super__._uncache.apply(this,arguments)},e.prototype._onUnload=function(){return this.dispose()},e.prototype.appEvents=null,e.prototype.routes=null,e}(o.View),o.Router=function(t){function e(t){return o.configure(this,t),this.app?(this.app.addChild(this),"function"==typeof this.triggers&&(this.triggers=this.triggers.call(this)),this.triggers?(this._routes={},this._bindTriggers(),e.__super__.constructor.apply(this,arguments),void 0):r("Giraffe routers require a `triggers` map of routes to app events.")):r("Giraffe routers require an app! Please create an instance of Giraffe.App before creating a router.")}return p(e,t),e.prototype.namespace="",e.prototype._fullNamespace=function(){return this.parentRouter?this.parentRouter._fullNamespace()+"/"+this.namespace:this.namespace},e.prototype.triggers=null,e.prototype._bindTriggers=function(){var t,e,n,i,o,l=this;this.triggers||r("Expected router to implement `triggers` hash in the form {route: appEvent}"),e=this._fullNamespace(),e.length>0&&(e+="/"),o=this.triggers,i=function(t,e,n){var i;return 0===s.indexOf(e,"-> ")?i=function(){var t;return t=e.slice(3),l.navigate(t,{trigger:!0})}:0===s.indexOf(e,"=> ")?i=function(){var t;return t=e.slice(3),l.navigate(n+t,{trigger:!0})}:(t=n+t,i=function(){var n,i;return n=arguments.length>=1?d.call(arguments,0):[],(i=l.app).trigger.apply(i,[e].concat(d.call(n),[t]))},l._registerRoute(e,t)),l.route(t,e,i)};for(n in o)t=o[n],i(n,t,e);return this},e.prototype._unbindTriggers=function(){var t;return t=this._getTriggerRegExpStrings(),i.history.handlers=s.reject(i.history.handlers,function(e){return s.contains(t,""+e.route)})},e.prototype._getTriggerRegExpStrings=function(){return s.map(s.keys(this.triggers),function(t){return""+i.Router.prototype._routeToRegExp(t)})},e.prototype.cause=function(){var t,e,n,o;return e=arguments[0],t=arguments.length>=2?d.call(arguments,1):[],n=this.getRoute.apply(this,[e].concat(d.call(t))),null!=n?i.history.navigate(n,{trigger:!0}):(o=this.app).trigger.apply(o,[e].concat(d.call(t)))},e.prototype.isCaused=function(){var t,e,n;return e=arguments[0],t=arguments.length>=2?d.call(arguments,1):[],n=this.getRoute.apply(this,[e].concat(d.call(t))),null!=n?i.history._hasPushState?window.location.pathname.slice(1)===n:window.location.hash===n:!1},e.prototype.getRoute=function(){var t,e,n;return e=arguments[0],t=arguments.length>=2?d.call(arguments,1):[],n=this._routes[e],null!=n?(n=this._reverseHash.apply(this,[n].concat(d.call(t))),n?i.history._hasPushState?n:"#"+n:""===n?"":null):null},e.prototype._registerRoute=function(t,e){return this._routes[t]=e},e.prototype._reverseHash=function(){var t,e,n,i,o;return i=arguments[0],t=arguments.length>=2?d.call(arguments,1):[],e=t[0],null==e?i:(o=/:\w+|\*\w+/g,n=s.isObject(e)?i.replace(o,function(t){var n;return n=t.slice(1),e[n]||""}):i.replace(o,function(){return t.shift()||""}))},e.prototype.reload=function(t){return t&&(i.history.stop(),window.location=t),window.location.reload()},e.prototype.appEvents=null,e.prototype.beforeDispose=function(){return this._unbindTriggers()},e}(i.Router),o.Model=function(t){function e(t,n){o.configure(this,n),e.__super__.constructor.apply(this,arguments)}return p(e,t),e.defaultOptions={},e.prototype.appEvents=null,e.prototype.beforeDispose=function(){var t;return null!=(t=this.collection)?t.remove(this):void 0},e}(i.Model),o.Collection=function(t){function e(t,n){o.configure(this,n),e.__super__.constructor.apply(this,arguments)}return p(e,t),e.defaultOptions={},e.prototype.model=o.Model,e.prototype.appEvents=null,e.prototype.beforeDispose=function(){var t,e,n,i;for(i=this.models.slice(),e=0,n=i.length;n>e;e++)t=i[e],t.dispose();return this},e}(i.Collection),o.configure=function(t,e){return t?(o.callFn(t,"beforeConfigure",t,e),null==t.dispose&&(t.dispose=o.disposeThis),o.callFn(t,"afterConfigure",t,e),t.initialize?o.wrapFn(t,"initialize",null,l):l.call(t),t):(r("Cannot configure obj",t),!1)},o.defaultOptions={},l=function(){return this.dataEvents?o.bindDataEvents(this):void 0},o.dispose=function(){var t,e;return e=arguments[0],t=arguments.length>=2?d.call(arguments,1):[],o.callFn.apply(o,[e,"beforeDispose"].concat(d.call(t))),"function"==typeof e.trigger&&e.trigger.apply(e,["disposing",e].concat(d.call(t))),"function"==typeof e.stopListening&&e.stopListening(),"function"==typeof e.trigger&&e.trigger.apply(e,["disposed",e].concat(d.call(t))),o.callFn.apply(o,[e,"afterDispose"].concat(d.call(t))),e},o.disposeThis=function(){var t;return t=arguments.length>=1?d.call(arguments,0):[],o.dispose.apply(o,[this].concat(d.call(t)))},o.bindAppEvents=function(t,e,n){return null==e&&(e=t.app),null==n&&(n=t.appEvents),o.bindEventMap(t,e,n)},o.bindDataEvents=function(t){var e,n,i,s,l,a;if(n=t.dataEvents){"function"==typeof n&&(n=t.dataEvents());for(i in n)e=n[i],l=i.split(" "),2>l.length?r("Data event must specify target object, ex: {'change collection': 'handler'}"):(a=l.pop(),a="this"===a||"@"===a?t:t[a],a?(s=l.join(" "),o.bindEvent(t,a,s,e)):r("Target object not found for data event '"+i+"'",t));return t}},o.bindEvent=function(){var t;return t=arguments.length>=1?d.call(arguments,0):[],t.push("listenTo"),a.apply(null,t)},o.unbindEvent=function(){var t;return t=arguments.length>=1?d.call(arguments,0):[],t.push("stopListening"),a.apply(null,t)},o.bindEventMap=function(){var t;return t=arguments.length>=1?d.call(arguments,0):[],t.push("listenTo"),u.apply(null,t)},o.unbindEventMap=function(){var t;return t=arguments.length>=1?d.call(arguments,0):[],t.push("stopListening"),u.apply(null,t)},a=function(t,e,n,i,o){return"string"==typeof i&&(i=t[i]),"function"!=typeof i?(r("callback for `'"+n+"'` not found",t,e,i),void 0):t[o](e,n,i)},u=function(t,e,n,i){var o,r;if("function"==typeof n&&(n=n.call(t)),n){for(r in n)o=n[r],a(t,e,r,o,i);return t}},o.wrapFn=function(t,e,n,i){var r,s,l,a;return a=t[e],"function"==typeof a?(l=e[0].toUpperCase()+e.slice(1),s="before"+l,r="after"+l,t[e]=function(){var e,l;return e=arguments.length>=1?d.call(arguments,0):[],null!=n&&n.apply(t,e),o.callFn.apply(o,[t,s].concat(d.call(e))),l=a.apply(t,e),o.callFn.apply(o,[t,r].concat(d.call(e))),null!=i&&i.apply(t,e),l}):void 0},o.callFn=function(){var t,e,n,i;return n=arguments[0],e=arguments[1],t=arguments.length>=3?d.call(arguments,2):[],"function"==typeof n[e]&&n[e].apply(n,t),(i=o.plugins).callFn.apply(i,[n,e].concat(d.call(t)))},o.plugins={plugins:[],DEFAULT_SORT_ORDER:.5,defaults:{name:null,description:null,author:null,initialize:function(){},targets:[o.View,o.App,o.Router,o.Model,o.Collection],copyToPrototype:null},hooksNames:{},getHooksName:function(t){var e,n;return e=this.hooksNames[t],e?e:(n="on"+t[0].toUpperCase()+t.slice(1),this.hooksNames[t]=n,n)},callFn:function(){var t,e,n,i,o,r,s,l;if(r=arguments[0],e=arguments[1],t=arguments.length>=3?d.call(arguments,2):[],o=this.getHooksName(e),i=r[o])for(s=0,l=i.length;l>s;s++)n=i[s],n.hook.apply(r,t);return this},add:function(t){var e,n,i,o,r,l;for(e=s.findWhere(this.plugins,{name:t.name}),e&&this.remove(e),s.defaults(t,this.defaults),this.plugins.push(t),l=t.targets,o=0,r=l.length;r>o;o++)i=l[o],n=i.prototype||i,s.extend(n,t.extendPrototype),this.addHooks(n,t);return t.initialize(),t},addHooks:function(t,e){var n,i,o,r,l;if(e.hooks){l=e.hooks;for(i in l)n=l[i],"function"==typeof n&&(n={hook:n,sortOrder:this.DEFAULT_SORT_ORDER}),r=this.getHooksName(i),o=null!=t[r]?t[r]:t[r]=[],o.push(n),o=s.sortBy(o,"sortOrder");return e.hooks}},remove:function(t){return this.plugins=s.without(this.plugins,t),t}},o.plugins.add({name:"App",description:"Adds the `app` object to `obj` and listens for `appEvents`.",author:"github.com/ryanatkn",hooks:{afterConfigure:{hook:function(){return null==this.app&&(this.app=o.app),this.appEvents?o.bindAppEvents(this):void 0}},beforeDispose:function(){return this.app=null}}}),o.plugins.add({name:"Extendable",description:"Extends `obj` with `options` during `Giraffe.configure`.\nOmits `omittedOptions` from the extended properties.\nIf `omittedOptions` is `true`, no options are extended.",author:"github.com/ryanatkn",initialize:function(){var t,e;return null==(t=o.Model.defaultOptions).omittedOptions&&(t.omittedOptions=[]),o.Model.defaultOptions.omittedOptions.push("parse"),null==(e=o.Collection.defaultOptions).omittedOptions&&(e.omittedOptions=[]),o.Collection.defaultOptions.omittedOptions.push("parse")},hooks:{beforeConfigure:function(t,e){var n,i,r,l;return i=s.extend({},o.defaultOptions,null!=(r=t.constructor)?r.defaultOptions:void 0,t.defaultOptions,e),n=null!=(l=i.omittedOptions)?l:t.omittedOptions,n!==!0?s.extend(t,s.omit(i,n)):void 0}}}),o.plugins.add({name:"Startable",description:"Adds the `addInitializer` and `start` to (a)synchronously get to a\nstate where `this.started = true`.",author:"github.com/ryanatkn",targets:[o.App],hooks:{beforeInitialize:function(){return this.started=!1},beforeDispose:function(){return this._initializers=null}},extendPrototype:{addInitializer:function(t){return this.started?(t.call(this,this._startOptions),s.extend(this,this._startOptions)):(null==this._initializers&&(this._initializers=[]),this._initializers.push(t)),this},start:function(t){var e,n=this;return null==t&&(t={}),this._startOptions=t,o.callFn.apply(o,[this,"beforeStart"].concat(d.call(arguments))),e=function(i){var l,a;return i?r(i):(l=null!=(a=n._initializers)?a.shift():void 0,l?2===l.length?l.call(n,t,e):(l.call(n,t),e()):(s.extend(n,t),n.started=!0,o.callFn.apply(o,[n,"afterStart"].concat(d.call(arguments)))))},e(),this}}})}).call(this);