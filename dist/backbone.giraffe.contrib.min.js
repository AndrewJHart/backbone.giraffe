(function(){var t,e={}.hasOwnProperty,i=function(t,i){function o(){this.constructor=t}for(var n in i)e.call(i,n)&&(t[n]=i[n]);return o.prototype=i.prototype,t.prototype=new o,t.__super__=i.prototype,t};t=Giraffe.Contrib={version:"0.1.3"},t.CollectionView=function(t){function e(){var t,i;if(e.__super__.constructor.apply(this,arguments),_.defaults(this,this.constructor.getDefaults(this)),_.isArray(this.collection)&&(this.collection=new Giraffe.Collection(this.collection)),!this.modelView)throw Error("`modelView` is required");if(!(null!=(t=this.collection)?t.model:void 0))throw Error("`collection.model` is required");this.listenTo(this.collection,"add",this.addOne),this.listenTo(this.collection,"remove",this.removeOne),this.listenTo(this.collection,"reset sort",this.render),this.modelViewEl&&(this.modelViewEl=(null!=(i=this.ui)?i[this.modelViewEl]:void 0)||this.modelViewEl)}return i(e,t),e.getDefaults=function(t){return{collection:t.collection?null:new Giraffe.Collection,modelView:Giraffe.View,modelViewArgs:null,modelViewEl:null}},e.prototype._calcAttachOptions=function(t){var e,i,o,n,l;for(o={el:null,method:"prepend"},i=this.collection.indexOf(t),e=1;n=this.collection.at(i-e);){if(l=_.findWhere(this.children,{model:n}),null!=l?l._isAttached:void 0){o.method="after",o.el=l.$el;break}e++}if(!o.el&&this.modelViewEl&&(o.el=this.$(this.modelViewEl),!o.el.length))throw Error("`modelViewEl` not found in this view");return o},e.prototype._cloneModelViewArgs=function(){var t;if(t=this.modelViewArgs||[{}],_.isFunction(t)&&(t=t.call(this)),_.isArray(t)||(t=[t]),t=_.map(t,_.clone),!_.isArray(t)||!_.isObject(t[0]))throw Error("`modelViewArgs` must be an array with an object as the first value");return t},e.prototype.afterRender=function(){var t,e,i,o;for(o=this.collection.models,e=0,i=o.length;i>e;e++)t=o[e],this.addOne(t);return this},e.prototype.removeOne=function(t){var e;return this.collection.contains(t)?this.collection.remove(t):(e=_.findWhere(this.children,{model:t}),null!=e&&e.dispose()),this},e.prototype.addOne=function(t){var e,i,o;return this.collection.contains(t)?this._renderedOnce?(e=this._calcAttachOptions(t),o=this._cloneModelViewArgs(),o[0].model=t,i=function(t,e,i){i.prototype=t.prototype;var o=new i,n=t.apply(o,e);return Object(n)===n?n:o}(this.modelView,o,function(){}),this.attach(i,e)):this.render():this.collection.add(t),this},e}(Giraffe.View),t.FastCollectionView=function(t){function e(){var t;if(e.__super__.constructor.apply(this,arguments),null==this.modelTemplate&&!_.isFunction(this.modelTemplateStrategy))throw Error("`modelTemplate` or a `modelTemplateStrategy` function is required");_.defaults(this,this.constructor.getDefaults(this)),_.isArray(this.collection)&&(this.collection=new Giraffe.Collection(this.collection)),this.listenTo(this.collection,"add",this.addOne),this.listenTo(this.collection,"remove",this.removeOne),this.listenTo(this.collection,"reset sort",this.render),this.modelEl&&(this.modelEl=(null!=(t=this.ui)?t[this.modelEl]:void 0)||this.modelEl),this.modelTemplateCtx={serialize:this.modelSerialize,template:this.modelTemplate},Giraffe.View.setTemplateStrategy(this.modelTemplateStrategy,this.modelTemplateCtx)}return i(e,t),e.getDefaults=function(t){return{collection:t.collection?null:new Giraffe.Collection,modelTemplate:null,modelSerialize:t.modelSerialize?null:function(){return this.model},modelTemplateStrategy:t.templateStrategy,modelEl:null}},e.prototype.afterRender=function(){if(this.$modelEl=this.modelEl?this.$(this.modelEl):this.$el,!this.$modelEl.length)throw Error("`$modelEl` not found after rendering");return this.addAll(),this},e.prototype.removeOne=function(t,e,i){var o,n;return this.collection.contains(t)?this.collection.remove(t):(o=null!=(n=null!=i?i.index:void 0)?n:i,this.removeByIndex(o)),this},e.prototype.addOne=function(t){var e;return this.collection.contains(t)?this._renderedOnce?(e=this._renderModel(t),this._insertModelHTML(e,t)):this.render():this.collection.add(t),this},e.prototype.addAll=function(){var t,e,i,o,n;for(t="",n=this.collection.models,i=0,o=n.length;o>i;i++)e=n[i],t+=this._renderModel(e);return this.$modelEl.empty().html(t),this},e.prototype.removeByIndex=function(t){var e;if(e=this.getElByIndex(t),!e.length)throw Error("Unable to find el with index "+t);return e.remove(),this},e.prototype.getElByModel=function(t){return this.getElByIndex(this.collection.indexOf(t))},e.prototype.getElByIndex=function(t){return $(this.$modelEl.children()[t])},e.prototype.getModelByEl=function(t){var e;return e=$(t).closest(this.$modelEl.children()).index(),this.collection.at(e)},e.prototype._renderModel=function(t){return this.modelTemplateCtx.model=t,this.modelTemplateCtx.templateStrategy()},e.prototype._insertModelHTML=function(t,e){var i,o,n,l,r;return i=this.$modelEl.children(),r=i.length,l=this.collection.indexOf(e),r===this.collection.length?(o=$(i[l]),o.replaceWith(t)):l>=r?this.$modelEl.append(t):(n=$(i[l-1]),n.length?n.after(t):this.$modelEl.append(t)),this},e}(Giraffe.View)}).call(this);