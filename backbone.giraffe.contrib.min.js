(function(){var e,t=function(e,t){return function(){return e.apply(t,arguments)}},i={}.hasOwnProperty,o=function(e,t){function o(){this.constructor=e}for(var l in t)i.call(t,l)&&(e[l]=t[l]);return o.prototype=t.prototype,e.prototype=new o,e.__super__=t.prototype,e};e=Giraffe.Contrib={version:"0.1.3"},e.CollectionView=function(e){function i(){this.addOne=t(this.addOne,this);var e,o;if(i.__super__.constructor.apply(this,arguments),_.defaults(this,this.constructor.getDefaults(this)),!this.modelView)throw Error("`modelView` is required");if(!(null!=(e=this.collection)?e.model:void 0))throw Error("`collection.model` is required");this.listenTo(this.collection,"add",this.addOne),this.listenTo(this.collection,"remove",this.removeOne),this.listenTo(this.collection,"reset",this.render),this.listenTo(this.collection,"sort",this.render),this.modelViewEl&&(this.modelViewEl=(null!=(o=this.ui)?o[this.modelViewEl]:void 0)||this.modelViewEl)}return o(i,e),i.getDefaults=function(e){return{collection:e.collection?null:new Giraffe.Collection,modelView:Giraffe.View,modelViewArgs:null,modelViewEl:null}},i.prototype._calcAttachOptions=function(e){var t,i,o,l,n;for(o={el:null,method:"prepend"},i=this.collection.indexOf(e),t=1;l=this.collection.at(i-t);){if(n=_.findWhere(this.children,{model:l}),null!=n?n._isAttached:void 0){o.method="after",o.el=n.$el;break}t++}if(!o.el&&this.modelViewEl&&(o.el=this.$(this.modelViewEl),!o.el.length))throw Error("`modelViewEl` not found in this view");return o},i.prototype._cloneModelViewArgs=function(){var e;if(e=this.modelViewArgs||[{}],_.isFunction(e)&&(e=e.call(this)),_.isArray(e)||(e=[e]),e=_.map(e,_.clone),!_.isArray(e)||!_.isObject(e[0]))throw Error("`modelViewArgs` must be an array with an object as the first value");return e},i.prototype.afterRender=function(){return this.collection.each(this.addOne),this},i.prototype.removeOne=function(e){var t;return this.collection.contains(e)?this.collection.remove(e):(t=_.findWhere(this.children,{model:e}),null!=t&&t.dispose()),this},i.prototype.addOne=function(e){var t,i,o;return this.collection.contains(e)?this._renderedOnce?(t=this._calcAttachOptions(e),o=this._cloneModelViewArgs(),o[0].model=e,i=function(e,t,i){i.prototype=e.prototype;var o=new i,l=e.apply(o,t);return Object(l)===l?l:o}(this.modelView,o,function(){}),this.attach(i,t)):this.render():this.collection.add(e),this},i}(Giraffe.View),e.FastCollectionView=function(e){function i(){this.addOne=t(this.addOne,this);var e;if(i.__super__.constructor.apply(this,arguments),null==this.modelTemplate&&!_.isFunction(this.modelTemplateStrategy))throw Error("`modelTemplate` or a `modelTemplateStrategy` function is required");_.defaults(this,this.constructor.getDefaults(this)),this.listenTo(this.collection,"add",this.addOne),this.listenTo(this.collection,"remove",this.removeOne),this.listenTo(this.collection,"reset",this.render),this.listenTo(this.collection,"sort",this.render),this.modelEl&&(this.modelEl=(null!=(e=this.ui)?e[this.modelEl]:void 0)||this.modelEl),this.modelTemplateCtx={serialize:this.modelSerialize,template:this.modelTemplate},Giraffe.View.setTemplateStrategy(this.modelTemplateStrategy,this.modelTemplateCtx)}return o(i,e),i.getDefaults=function(e){return{collection:e.collection?null:new Giraffe.Collection,modelTemplate:null,modelTemplateStrategy:e.templateStrategy,modelSerialize:null,modelEl:null}},i.prototype.afterRender=function(){if(this.$modelEl=this.modelEl?this.$(this.modelEl):this.$el,!this.$modelEl.length)throw Error("`$modelEl` not found after rendering");return this.addAll(),this},i.prototype.removeOne=function(e,t,i){var o,l;return this.collection.contains(e)?this.collection.remove(e):(o=null!=(l=null!=i?i.index:void 0)?l:i,this.removeByIndex(o)),this},i.prototype.addOne=function(e){var t;return this.collection.contains(e)?this._renderedOnce?(t=this._renderModel(e),this._insertModelHTML(t,e)):this.render():this.collection.add(e),this},i.prototype.addAll=function(){var e,t,i,o,l;for(e="",l=this.collection.models,i=0,o=l.length;o>i;i++)t=l[i],e+=this._renderModel(t);return this.$modelEl.empty().html(e),this},i.prototype.removeByIndex=function(e){var t;if(t=this.getElByIndex(e),!t.length)throw Error("Unable to find el with index "+e);return t.remove(),this},i.prototype.getElByModel=function(e){return this.getElByIndex(this.collection.indexOf(e))},i.prototype.getElByIndex=function(e){return $(this.$modelEl.children()[e])},i.prototype.getModelByEl=function(e){var t;return t=$(e).closest(this.$modelEl.children()).index(),this.collection.at(t)},i.prototype.modelSerialize=function(){return this.model},i.prototype._renderModel=function(e){return this.modelTemplateCtx.model=e,this.modelTemplateCtx.templateStrategy()},i.prototype._insertModelHTML=function(e,t){var i,o,l,n,r;return i=this.$modelEl.children(),r=i.length,n=this.collection.indexOf(t),r===this.collection.length?(o=$(i[n]),o.replaceWith(e)):n>=r?this.$modelEl.append(e):(l=$(i[n-1]),l.length?l.after(e):this.$modelEl.append(e)),this},i}(Giraffe.View)}).call(this);