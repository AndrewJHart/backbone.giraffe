(function(){var e,t={}.hasOwnProperty,i=function(e,i){function o(){this.constructor=e}for(var l in i)t.call(i,l)&&(e[l]=i[l]);return o.prototype=i.prototype,e.prototype=new o,e.__super__=i.prototype,e};e=Giraffe.Contrib={version:"0.1.4"},e.Controller=function(){function e(e){Giraffe.configure(this,e)}return _.extend(e.prototype,Backbone.Events),e}(),e.CollectionView=function(e){function t(){var e,i;if(t.__super__.constructor.apply(this,arguments),_.defaults(this,this.constructor.getDefaults(this)),_.isArray(this.collection)&&(this.collection=new Giraffe.Collection(this.collection)),!this.modelView)throw Error("`modelView` is required");if(!(null!=(e=this.collection)?e.model:void 0))throw Error("`collection.model` is required");this.listenTo(this.collection,"add",this.addOne),this.listenTo(this.collection,"remove",this.removeOne),this.listenTo(this.collection,"reset sort",this.render),this.renderOnChange&&this.listenTo(this.collection,"change",this._onChangeModel),this.modelViewEl&&(this.modelViewEl=(null!=(i=this.ui)?i[this.modelViewEl]:void 0)||this.modelViewEl)}return i(t,e),t.getDefaults=function(e){return{collection:e.collection?null:new Giraffe.Collection,modelView:Giraffe.View,modelViewArgs:null,modelViewEl:null,renderOnChange:!1}},t.prototype._onChangeModel=function(e){var t;return t=this.findByModel(e),t.render()},t.prototype.findByModel=function(e){var t,i,o,l;for(l=this.children,i=0,o=l.length;o>i;i++)if(t=l[i],t.model===e)return t;return null},t.prototype._calcAttachOptions=function(e){var t,i,o,l,n;for(o={el:null,method:"prepend"},i=this.collection.indexOf(e),t=1;l=this.collection.at(i-t);){if(n=this.findByModel(l),null!=n?n._isAttached:void 0){o.method="after",o.el=n.$el;break}t++}if(!o.el&&this.modelViewEl&&(o.el=this.$(this.modelViewEl),!o.el.length))throw Error("`modelViewEl` not found in this view");return o},t.prototype._cloneModelViewArgs=function(){var e;if(e=this.modelViewArgs||[{}],_.isFunction(e)&&(e=e.call(this)),_.isArray(e)||(e=[e]),e=_.map(e,_.clone),!_.isArray(e)||!_.isObject(e[0]))throw Error("`modelViewArgs` must be an array with an object as the first value");return e},t.prototype.afterRender=function(){var e,t,i,o;for(o=this.collection.models,t=0,i=o.length;i>t;t++)e=o[t],this.addOne(e);return this},t.prototype.removeOne=function(e){var t;return this.collection.contains(e)?this.collection.remove(e):(t=_.findWhere(this.children,{model:e}),null!=t&&t.dispose()),this},t.prototype.addOne=function(e){var t,i,o;return this.collection.contains(e)?this._renderedOnce?(t=this._calcAttachOptions(e),o=this._cloneModelViewArgs(),o[0].model=e,i=function(e,t,i){i.prototype=e.prototype;var o=new i,l=e.apply(o,t);return Object(l)===l?l:o}(this.modelView,o,function(){}),this.attach(i,t)):this.render():this.collection.add(e),this},t}(Giraffe.View),e.FastCollectionView=function(e){function t(){var e;if(t.__super__.constructor.apply(this,arguments),null==this.modelTemplate&&!_.isFunction(this.modelTemplateStrategy))throw Error("`modelTemplate` or a `modelTemplateStrategy` function is required");_.defaults(this,this.constructor.getDefaults(this)),_.isArray(this.collection)&&(this.collection=new Giraffe.Collection(this.collection)),this.listenTo(this.collection,"add",this.addOne),this.listenTo(this.collection,"remove",this.removeOne),this.listenTo(this.collection,"reset sort",this.render),this.renderOnChange&&this.listenTo(this.collection,"change",this.addOne),this.modelEl&&(this.modelEl=(null!=(e=this.ui)?e[this.modelEl]:void 0)||this.modelEl),this.modelTemplateCtx={serialize:this.modelSerialize,template:this.modelTemplate},Giraffe.View.setTemplateStrategy(this.modelTemplateStrategy,this.modelTemplateCtx)}return i(t,e),t.getDefaults=function(e){return{collection:e.collection?null:new Giraffe.Collection,modelTemplate:null,modelSerialize:e.modelSerialize?null:function(){return this.model},modelTemplateStrategy:e.templateStrategy,modelEl:null,renderOnChange:!0}},t.prototype.afterRender=function(){if(this.$modelEl=this.modelEl?this.$(this.modelEl):this.$el,!this.$modelEl.length)throw Error("`$modelEl` not found after rendering");return this.addAll(),this},t.prototype.removeOne=function(e,t,i){var o,l;return this.collection.contains(e)?this.collection.remove(e):(o=null!=(l=null!=i?i.index:void 0)?l:i,this.removeByIndex(o)),this},t.prototype.addOne=function(e){var t;return this.collection.contains(e)?this._renderedOnce?(t=this._renderModel(e),this._insertModelHTML(t,e)):this.render():this.collection.add(e),this},t.prototype.addAll=function(){var e,t,i,o,l;for(e="",l=this.collection.models,i=0,o=l.length;o>i;i++)t=l[i],e+=this._renderModel(t);return this.$modelEl.empty()[0].innerHTML=e,this},t.prototype.removeByIndex=function(e){var t;if(t=this.findElByIndex(e),!t.length)throw Error("Unable to find el with index "+e);return t.remove(),this},t.prototype.findElByModel=function(e){return this.findElByIndex(this.collection.indexOf(e))},t.prototype.findElByIndex=function(e){return $(this.$modelEl.children()[e])},t.prototype.findModelByEl=function(e){var t;return t=$(e).closest(this.$modelEl.children()).index(),this.collection.at(t)},t.prototype._renderModel=function(e){return this.modelTemplateCtx.model=e,this.modelTemplateCtx.templateStrategy()},t.prototype._insertModelHTML=function(e,t){var i,o,l,n,r;return i=this.$modelEl.children(),r=i.length,n=this.collection.indexOf(t),r===this.collection.length?(o=$(i[n]),o.replaceWith(e)):n>=r?this.$modelEl.append(e):(l=$(i[n-1]),l.length?l.after(e):this.$modelEl.prepend(e)),this},t}(Giraffe.View)}).call(this);