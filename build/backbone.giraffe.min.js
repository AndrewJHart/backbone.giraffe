(function(){var t,e,n,i,r,o=function(t,e){return function(){return t.apply(e,arguments)}},s={}.hasOwnProperty,a=function(t,e){function n(){this.constructor=t}for(var i in e)s.call(e,i)&&(t[i]=e[i]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},p=[].slice;t="undefined"!=typeof global&&null!==global?require("backbone"):window.Backbone,t.Giraffe=e={app:null,apps:{},views:{}},"undefined"!=typeof window&&null!==window&&(window.Giraffe=e),n=function(){var t,e;return"undefined"!=typeof console&&null!==console?null!=(t=console.error)?t.apply(console,(e=["Backbone.Giraffe error:"]).concat.apply(e,arguments)):void 0:void 0},e.View=function(t){function i(t){null==t&&(t={}),this.render=o(this.render,this),_.defaults(t,e.View.defaultOptions),this.app||(this.app=t.app||e.app),e.bindEventMap(this.app,this.appEvents,this),this.children=[],this.parent=null,this._renderedOnce=!1,this._isAttached=!1,this._createEventsFromUIElements(),this._wrapInitialize(),i.__super__.constructor.call(this,t)}return a(i,t),i.defaultOptions={disposeOnDetach:!0,alwaysRender:!1,saveScrollPosition:!1,documentTitle:null},i.prototype._wrapInitialize=function(){var t=this;return this.initialize=_.wrap(this.initialize,function(e){return t._cache(),t.$el.attr("data-view-cid",t.cid),e.apply(t,Array.prototype.slice.call(arguments,1)),t._bindDataEvents()})},i.prototype._attachMethods=["append","prepend","html","after","before","insertAfter","insertBefore"],i.prototype._siblingAttachMethods=["after","before","insertAfter","insertBefore"],i.prototype.attachTo=function(t,i){var r,o,s,a,p,l;return a=(null!=i?i.method:void 0)||"append",s=(null!=i?i.forceRender:void 0)||!1,l=(null!=i?i.suppressRender:void 0)||!1,this.$el?(_.contains(this._attachMethods,a)||(n("The attach method '"+a+"' isn't supported. Defaulting to 'append'.",a,this._attachMethods),a="append"),o=e.View.to$El(t),r=_.contains(this._siblingAttachMethods,a)?o.parent():o,"insertAfter"===a&&(a="after"),"insertBefore"===a&&(a="before"),1!==o.length?(n("Expected to render to a single element but found "+o.length,t),this):(this.detach(!0),this.setParent(e.View.getClosestView(r)),"html"===a&&(e.View.detachByEl(o),o.empty()),o[a](this.$el),this._isAttached=!0,p=!l&&(!this._renderedOnce||s||this.options.alwaysRender),p&&this.render(i),this.options.saveScrollPosition&&this._loadScrollPosition(),null!=this.options.documentTitle&&(document.title=this.options.documentTitle),this)):(n("Trying to attach a disposed view. Make a new one or create the view with the option `disposeOnDetach` set to false.",this),this)},i.prototype.attach=function(t,e){var i;return(null!=e?e.el:void 0)?(i=this.$el.find(e.el),i.length?t.attachTo(i,e):this.$el.is(e.el)?t.attachTo(this.$el,e):n("Attempting to attach to an element that doesn't exist inside this view!",e,t,this)):t.attachTo(this.$el,e),this},i.prototype.render=function(t){return"function"==typeof this.beforeRender&&this.beforeRender(t),this._renderedOnce=!0,this.detachChildren(null!=t?t.preserve:void 0),this.$el.empty().html(("function"==typeof this.getHTML?this.getHTML(t):void 0)||""),this._cacheUiElements(),"function"==typeof this.afterRender&&this.afterRender(t),this},i.prototype.getHTML=function(){return""},i.prototype.beforeRender=function(){},i.prototype.afterRender=function(){},i.prototype.detach=function(t){return null==t&&(t=!1),this._isAttached?(this._isAttached=!1,this.options.saveScrollPosition&&this._saveScrollPosition(),this.$el.detach(),this.options.disposeOnDetach&&!t&&this.dispose(),this):this},i.prototype.detachChildren=function(t){var e,n,i,r;for(null==t&&(t=!1),r=this.children.slice(),n=0,i=r.length;i>n;n++)e=r[n],"function"==typeof e.detach&&e.detach(t);return this},i.prototype._saveScrollPosition=function(){return this._scrollPosition=this._getScrollPositionEl().scrollTop()},i.prototype._loadScrollPosition=function(){return null!=this._scrollPosition?this._getScrollPositionEl().scrollTop(this._scrollPosition):void 0},i.prototype._getScrollPositionEl=function(){switch(typeof this.options.saveScrollPosition){case"string":return this.$(this.options.saveScrollPosition).first();case"object":return $(this.options.saveScrollPosition);default:return this.$el}},i.prototype.addChild=function(t){var e;return _.contains(this.children,t)||(null!=(e=t.parent)&&e.removeChild(t,!0),t.parent=this,this.children.push(t)),this},i.prototype.addChildren=function(t){var e,n,i;for(n=0,i=t.length;i>n;n++)e=t[n],this.addChild(e);return this},i.prototype.removeChild=function(t,e){var n;return null==e&&(e=!1),n=_.indexOf(this.children,t),n>-1&&(this.children.splice(n,1),t.parent=null,e?"function"==typeof t.detach&&t.detach(!0):"function"==typeof t.dispose&&t.dispose()),this},i.prototype.removeChildren=function(t){var e,n,i,r;for(null==t&&(t=!1),r=this.children.slice(),n=0,i=r.length;i>n;n++)e=r[n],this.removeChild(e,t);return this},i.prototype.setParent=function(t){return t?t.addChild(this):this.parent&&(this.parent.removeChild(this,!0),this.parent=null),this},i.prototype.isAttached=function(t){return t?t.$el?this.parent===t:this.$el.parent().is(t):$(document).find(this.$el).length>0},i.prototype.ui=null,i.prototype._cacheUiElements=function(){var t,e,n;if(this.ui){n=this.ui;for(t in n)e=n[t],this[t]=this.$(e)}return this},i.prototype._uncacheUiElements=function(){var t,e,n;if(!this.ui)return this;n=this.ui;for(t in n)e=n[t],delete this[t];return this},i.prototype._createEventsFromUIElements=function(){var t,e,n,i;if(!this.events||!this.ui)return this;"function"==typeof this.ui&&(this.ui=this.ui()),"function"==typeof this.events&&(this.events=this.events()),i=this.events;for(t in i)e=i[t],n=this._getEventKeyFromUIElements(t),n!==t&&(delete this.events[t],this.events[n]=e);return this},i.prototype._getEventKeyFromUIElements=function(t){var e,n,i,r;return i=t.split(" "),n=i.length,2>n?t:(e=i[n-1],r=this.ui[e],r?(i[n-1]=r,i.join(" ")):t)},i.prototype._bindDataEvents=function(){var t,i,r,o,s,a;if(!this.dataEvents)return this;"function"==typeof this.dataEvents&&(this.dataEvents=this.dataEvents()),a=this.dataEvents;for(i in a)t=a[i],o=i.split(" "),2>o.length?n("Data event must specify target object, ex: {'change collection': 'handler'}"):(s=o.pop(),s="this"===s||"@"===s?this:this[s],s?(r=o.join(" "),e.bindEvent(s,r,t,this)):n("Unknown taget object "+s+" for data event",i));return this},i.prototype._uncache=function(){return delete e.views[this.cid],this},i.prototype._cache=function(){return e.views[this.cid]=this,this},i.prototype.invoke=function(){var t,e,i;for(e=arguments[0],t=arguments.length>=2?p.call(arguments,1):[],i=this;i&&!i[e];)i=i.parent;return(null!=i?i[e]:void 0)?i[e].apply(i,t):(n("No such method in view hierarchy",e,t,this),!0)},i.prototype.appEvents=null,i.prototype.dispose=function(){return e.dispose(this,function(){return this.setParent(null),this.removeChildren(),this._uncacheUiElements(),this._uncache(),this.remove(),this.$el=null})},i.detachByEl=function(t,n){var i,r,o,s;for(null==n&&(n=!1),r=e.View.to$El(t);(i=r.find("[data-view-cid]:first")).length;)o=i.attr("data-view-cid"),s=e.View.getByCid(o),s.detach(n);return this},i.getClosestView=function(t){var n,i;return n=e.View.to$El(t),i=n.closest("[data-view-cid]").attr("data-view-cid"),e.View.getByCid(i)},i.getByCid=function(t){return e.views[t]},i.to$El=function(t){return(null!=t?t.$el:void 0)||(t instanceof $?t:$(t))},i.removeDocumentEvents=function(){var t,e,n,r,o;if(null!=(r=i._currentDocumentEvents)?r.length:void 0){for(o=i._currentDocumentEvents,e=0,n=o.length;n>e;e++)t=o[e],$(document).off(t,"[data-gf-"+t+"]");return i._currentDocumentEvents=null}},i.setDocumentEvents=function(t){var e,n,r,o;for("string"==typeof t&&(t=t.split(" ")),_.isArray(t)||(t=[t]),t=_.compact(t),i.removeDocumentEvents(),i._currentDocumentEvents=t,o=[],n=0,r=t.length;r>n;n++)e=t[n],o.push(function(t){return $(document).on(t,"[data-gf-"+t+"]",function(e){var n,r,o;return n=$(e.target).closest("[data-gf-"+t+"]"),r=n.attr("data-gf-"+t),o=i.getClosestView(n),o.invoke(r,e)})}(e));return o},i.setDocumentEvents(["click","change"]),i}(t.View),e.App=function(t){function i(){var t=this;this.app=this,this._initializers=[],this.started=!1,$(window).unload(function(){return t.dispose()}),i.__super__.constructor.apply(this,arguments)}return a(i,t),i.prototype._cache=function(){var t;return null==e.app&&(e.app=this),this._name=(null!=(t=this.options)?t.name:void 0)||this.cid,e.apps[this._name]=this,this.$el.attr("data-gf-app",this._name),i.__super__._cache.apply(this,arguments)},i.prototype._uncache=function(){return e.app===this&&(e.app=null),delete e.apps[this._name],i.__super__._uncache.apply(this,arguments)},i.prototype.addInitializer=function(t){return this.started?t.call(this,this.options):this._initializers.push(t),this},i.prototype.start=function(t){var e,i=this;return null==t&&(t={}),this.trigger("app:initializing",t),e=function(r){var o;return r?n(r):(o=i._initializers.shift(),o?2===o.length?o.call(i,t,e):(o.call(i,t),e()):(_.extend(i.options,t),i.started=!0,i.trigger("app:initialized",t)))},e(),this},i}(e.View),e.Router=function(i){function r(t){return null==t&&(t={}),this.app=t.app||e.app,this.app?(this.app.addChild(this),e.bindEventMap(this.app,this.appEvents,this),t.triggers&&(this.triggers=t.triggers),"function"==typeof this.triggers&&(this.triggers=this.triggers()),this.triggers?(t.parentRouter&&(this.parentRouter=t.parentRouter),t.namespace?this.namespace=t.namespace:this.namespace||(this.namespace=e.Router.defaultNamespace),this._routes={},this._bindTriggers(),r.__super__.constructor.apply(this,arguments),void 0):n("Giraffe routers require a `triggers` map of routes to app events.")):n("Giraffe routers require an app! Please create an instance of Giraffe.App before creating a router.")}return a(r,i),r.defaultNamespace="",r.prototype._fullNamespace=function(){return this.parentRouter?this.parentRouter._fullNamespace()+"/"+this.namespace:this.namespace},r.prototype.triggers=null,r.prototype.reload=function(e){return e&&(t.history.stop(),window.location=e),window.location.reload()},r.prototype._bindTriggers=function(){var t,e,i,r,o,s=this;this.triggers||n("Expected router to implement `triggers` hash in the form {route: appEvent}"),e=this._fullNamespace(),e.length>0&&(e+="/"),o=this.triggers,r=function(t,e,n){var i;return 0===_.indexOf(e,"-> ")?i=function(){var t;return t=e.slice(3),s.navigate(t,{trigger:!0})}:0===_.indexOf(e,"=> ")?i=function(){var t;return t=e.slice(3),s.navigate(n+t,{trigger:!0})}:(t=n+t,i=function(){var n,i;return n=arguments.length>=1?p.call(arguments,0):[],(i=s.app).trigger.apply(i,[e].concat(p.call(n),[t]))},s._registerRoute(e,t)),s.route(t,e,i)};for(i in o)t=o[i],r(i,t,e);return this},r.prototype.cause=function(e,n){var i;return i=this.getRoute(e,n),null!=i?t.history.navigate(i,{trigger:!0}):this.app.trigger(e,n)},r.prototype.isCaused=function(e,n){var i;return i=this.getRoute(e,n),null!=i?t.history._hasPushState?window.location.pathname.slice(1)===i:window.location.hash===i:!1},r.prototype.getRoute=function(e,n){var i;return i=this._routes[e],null!=i?(i=this._reverseHash(i,n),i?t.history._hasPushState?i:"#"+i:""===i?"":null):null},r.prototype._registerRoute=function(t,e){return this._routes[t]=e},r.prototype._reverseHash=function(e,n){var i,r,o,s,a,p,l;if(!n)return e;if(s=/:(\w+)\b/g,o=e.match(s))for(p=0,l=o.length;l>p;p++)r=o[p],i=r.slice(1),a=n instanceof t.Model?n.get(i):_.isObject(n)?n[i]:n,e=e.replace(RegExp(""+r,"g"),a);return e},r.prototype.appEvents=null,r.prototype.dispose=function(){return e.dispose(this,function(){})},r}(t.Router),e.Model=function(t){function n(t,i){this.app||(this.app=(null!=i?i.app:void 0)||e.app),e.bindEventMap(this.app,this.appEvents,this),n.__super__.constructor.apply(this,arguments)}return a(n,t),n.prototype.appEvents=null,n.prototype.dispose=function(){return e.dispose(this,function(){var t;return null!=(t=this.collection)?t.remove(this):void 0})},n}(t.Model),e.Collection=function(t){function n(t,i){this.app||(this.app=(null!=i?i.app:void 0)||e.app),e.bindEventMap(this.app,this.appEvents,this),n.__super__.constructor.apply(this,arguments)}return a(n,t),n.prototype.model=e.Model,n.prototype.appEvents=null,n.prototype.dispose=function(){return e.dispose(this,function(){var t,e,n,i,r;for(i=this.models,r=[],e=0,n=i.length;n>e;e++)t=i[e],r.push(t.dispose());return r})},n}(t.Collection),e.dispose=function(){var t,e,n;return n=arguments[0],e=arguments[1],t=arguments.length>=3?p.call(arguments,2):[],"function"==typeof n.trigger&&n.trigger.apply(n,["disposing",n].concat(p.call(t))),null!=e&&e.apply(n,t),"function"==typeof n.stopListening&&n.stopListening(),n.app=null,"function"==typeof n.trigger&&n.trigger.apply(n,["disposed",n].concat(p.call(t))),n},e.bindEvent=function(){var t;return t=arguments.length>=1?p.call(arguments,0):[],i.apply(null,t.concat("listenTo"))},e.unbindEvent=function(){var t;return t=arguments.length>=1?p.call(arguments,0):[],i.apply(null,t.concat("stopListening"))},e.bindEventMap=function(){var t;return t=arguments.length>=1?p.call(arguments,0):[],r.apply(null,t.concat("listenTo"))},e.unbindEventMap=function(){var t;return t=arguments.length>=1?p.call(arguments,0):[],r.apply(null,t.concat("stopListening"))},i=function(t,e,i,r,o){return t&&r&&e&&o?("string"==typeof i&&(i=r[i]),i?r[o](t,e,i):(n("callback for `"+e+"` not found: "+i,r,t),void 0)):void 0},r=function(t,e,n,r){var o,s;if("function"==typeof e&&(e=e()),e){for(s in e)o=e[s],i(t,s,o,n,r);return null}}}).call(this);